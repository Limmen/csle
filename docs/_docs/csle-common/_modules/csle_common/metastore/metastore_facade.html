<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>csle_common.metastore.metastore_facade &mdash; csle-common 0.7.0 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> csle-common
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../csle_common.constants.html">csle_common.constants package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../csle_common.consumer_threads.html">csle_common.consumer_threads package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../csle_common.controllers.html">csle_common.controllers package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../csle_common.dao.html">csle_common.dao package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../csle_common.logging.html">csle_common.logging package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../csle_common.metastore.html">csle_common.metastore package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../csle_common.tunneling.html">csle_common.tunneling package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../csle_common.util.html">csle_common.util package</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">csle-common</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      <li>csle_common.metastore.metastore_facade</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for csle_common.metastore.metastore_facade</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Tuple</span>
<span class="kn">import</span> <span class="nn">psycopg</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">zlib</span>
<span class="kn">import</span> <span class="nn">csle_common.constants.constants</span> <span class="k">as</span> <span class="nn">constants</span>
<span class="kn">from</span> <span class="nn">csle_common.dao.emulation_config.emulation_env_config</span> <span class="kn">import</span> <span class="n">EmulationEnvConfig</span>
<span class="kn">from</span> <span class="nn">csle_common.dao.simulation_config.simulation_env_config</span> <span class="kn">import</span> <span class="n">SimulationEnvConfig</span>
<span class="kn">from</span> <span class="nn">csle_common.dao.emulation_config.emulation_trace</span> <span class="kn">import</span> <span class="n">EmulationTrace</span>
<span class="kn">from</span> <span class="nn">csle_common.dao.simulation_config.simulation_trace</span> <span class="kn">import</span> <span class="n">SimulationTrace</span>
<span class="kn">from</span> <span class="nn">csle_common.dao.emulation_config.emulation_simulation_trace</span> <span class="kn">import</span> <span class="n">EmulationSimulationTrace</span>
<span class="kn">from</span> <span class="nn">csle_common.logging.log</span> <span class="kn">import</span> <span class="n">Logger</span>
<span class="kn">from</span> <span class="nn">csle_common.dao.system_identification.emulation_statistics</span> <span class="kn">import</span> <span class="n">EmulationStatistics</span>
<span class="kn">from</span> <span class="nn">csle_common.dao.training.experiment_execution</span> <span class="kn">import</span> <span class="n">ExperimentExecution</span>
<span class="kn">from</span> <span class="nn">csle_common.dao.training.multi_threshold_stopping_policy</span> <span class="kn">import</span> <span class="n">MultiThresholdStoppingPolicy</span>
<span class="kn">from</span> <span class="nn">csle_common.dao.training.linear_threshold_stopping_policy</span> <span class="kn">import</span> <span class="n">LinearThresholdStoppingPolicy</span>
<span class="kn">from</span> <span class="nn">csle_common.dao.jobs.training_job_config</span> <span class="kn">import</span> <span class="n">TrainingJobConfig</span>
<span class="kn">from</span> <span class="nn">csle_common.dao.jobs.data_collection_job_config</span> <span class="kn">import</span> <span class="n">DataCollectionJobConfig</span>
<span class="kn">from</span> <span class="nn">csle_common.dao.jobs.system_identification_job_config</span> <span class="kn">import</span> <span class="n">SystemIdentificationJobConfig</span>
<span class="kn">from</span> <span class="nn">csle_common.dao.system_identification.gaussian_mixture_system_model</span> <span class="kn">import</span> <span class="n">GaussianMixtureSystemModel</span>
<span class="kn">from</span> <span class="nn">csle_common.dao.system_identification.empirical_system_model</span> <span class="kn">import</span> <span class="n">EmpiricalSystemModel</span>
<span class="kn">from</span> <span class="nn">csle_common.dao.system_identification.mcmc_system_model</span> <span class="kn">import</span> <span class="n">MCMCSystemModel</span>
<span class="kn">from</span> <span class="nn">csle_common.dao.system_identification.gp_system_model</span> <span class="kn">import</span> <span class="n">GPSystemModel</span>
<span class="kn">from</span> <span class="nn">csle_common.dao.encoding.np_encoder</span> <span class="kn">import</span> <span class="n">NpEncoder</span>
<span class="kn">from</span> <span class="nn">csle_common.dao.training.ppo_policy</span> <span class="kn">import</span> <span class="n">PPOPolicy</span>
<span class="kn">from</span> <span class="nn">csle_common.dao.training.tabular_policy</span> <span class="kn">import</span> <span class="n">TabularPolicy</span>
<span class="kn">from</span> <span class="nn">csle_common.dao.training.alpha_vectors_policy</span> <span class="kn">import</span> <span class="n">AlphaVectorsPolicy</span>
<span class="kn">from</span> <span class="nn">csle_common.dao.training.dqn_policy</span> <span class="kn">import</span> <span class="n">DQNPolicy</span>
<span class="kn">from</span> <span class="nn">csle_common.dao.training.fnn_with_softmax_policy</span> <span class="kn">import</span> <span class="n">FNNWithSoftmaxPolicy</span>
<span class="kn">from</span> <span class="nn">csle_common.dao.training.vector_policy</span> <span class="kn">import</span> <span class="n">VectorPolicy</span>
<span class="kn">from</span> <span class="nn">csle_common.dao.emulation_config.emulation_execution</span> <span class="kn">import</span> <span class="n">EmulationExecution</span>
<span class="kn">from</span> <span class="nn">csle_common.dao.management.management_user</span> <span class="kn">import</span> <span class="n">ManagementUser</span>
<span class="kn">from</span> <span class="nn">csle_common.dao.management.session_token</span> <span class="kn">import</span> <span class="n">SessionToken</span>
<span class="kn">from</span> <span class="nn">csle_common.dao.datasets.traces_dataset</span> <span class="kn">import</span> <span class="n">TracesDataset</span>
<span class="kn">from</span> <span class="nn">csle_common.dao.datasets.statistics_dataset</span> <span class="kn">import</span> <span class="n">StatisticsDataset</span>
<span class="kn">from</span> <span class="nn">csle_common.dao.emulation_config.config</span> <span class="kn">import</span> <span class="n">Config</span>
<span class="kn">from</span> <span class="nn">csle_common.util.general_util</span> <span class="kn">import</span> <span class="n">GeneralUtil</span>


<div class="viewcode-block" id="MetastoreFacade"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade">[docs]</a><span class="k">class</span> <span class="nc">MetastoreFacade</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Facade for the metastore, contains methods for querying the metastore</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="MetastoreFacade.list_emulations"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_emulations">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_emulations</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">EmulationEnvConfig</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of emulations in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EMULATIONS_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_emulation_record_to_dto</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">records</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetastoreFacade.list_emulations_ids"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_emulations_ids">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_emulations_ids</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of emulation ids and names in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT id,name FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EMULATIONS_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span> <span class="n">records</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetastoreFacade.get_emulation_by_name"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.get_emulation_by_name">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_emulation_by_name</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">EmulationEnvConfig</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for extracting the metadata of an emulation with a given name</span>

<span class="sd">        :param name: the name of the emulation</span>
<span class="sd">        :return: The emulation config or None if the emulation was not found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EMULATIONS_TABLE</span><span class="si">}</span><span class="s2"> WHERE name = %s&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">name</span><span class="p">,))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">record</span> <span class="o">=</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_emulation_record_to_dto</span><span class="p">(</span><span class="n">emulation_record</span><span class="o">=</span><span class="n">record</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">record</span></div>

<div class="viewcode-block" id="MetastoreFacade.get_emulation"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.get_emulation">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_emulation</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">EmulationEnvConfig</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for extracting the metadata of an emulation with a id</span>

<span class="sd">        :param id: the id of the emulation</span>
<span class="sd">        :return: The emulation config or None if the emulation was not found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EMULATIONS_TABLE</span><span class="si">}</span><span class="s2"> WHERE id = %s&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">record</span> <span class="o">=</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_emulation_record_to_dto</span><span class="p">(</span><span class="n">emulation_record</span><span class="o">=</span><span class="n">record</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">record</span></div>

<div class="viewcode-block" id="MetastoreFacade.list_simulations"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_simulations">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_simulations</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">SimulationEnvConfig</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of simulations in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">SIMULATIONS_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_simulation_record_to_dto</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">records</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetastoreFacade.list_simulation_ids"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_simulation_ids">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_simulation_ids</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of simulation ids and names in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT id,name FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">SIMULATIONS_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span> <span class="n">records</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetastoreFacade.get_simulation_by_name"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.get_simulation_by_name">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_simulation_by_name</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">SimulationEnvConfig</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for extracting the metadata of a simulation with a given name</span>

<span class="sd">        :param name: the name of the simulation</span>
<span class="sd">        :return: The simulation config or None if the simulation was not found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">SIMULATIONS_TABLE</span><span class="si">}</span><span class="s2"> WHERE name = %s&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">name</span><span class="p">,))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">record</span> <span class="o">=</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_simulation_record_to_dto</span><span class="p">(</span><span class="n">simulation_record</span><span class="o">=</span><span class="n">record</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">record</span></div>

<div class="viewcode-block" id="MetastoreFacade.get_simulation"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.get_simulation">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_simulation</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">SimulationEnvConfig</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for extracting the metadata of a simulation with a given id</span>

<span class="sd">        :param id: the id of the simulation</span>
<span class="sd">        :return: The simulation config or None if the simulation was not found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">SIMULATIONS_TABLE</span><span class="si">}</span><span class="s2"> WHERE id = %s&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">record</span> <span class="o">=</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_simulation_record_to_dto</span><span class="p">(</span><span class="n">simulation_record</span><span class="o">=</span><span class="n">record</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">record</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_convert_emulation_record_to_dto</span><span class="p">(</span><span class="n">emulation_record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmulationEnvConfig</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts an emulation record fetched from the metastore into a DTO</span>

<span class="sd">        :param emulation_record: the record to convert</span>
<span class="sd">        :return: the DTO representing the record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">emulation_config_json_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">emulation_record</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
        <span class="n">emulation_env_config</span><span class="p">:</span> <span class="n">EmulationEnvConfig</span> <span class="o">=</span> <span class="n">EmulationEnvConfig</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">emulation_config_json_str</span><span class="p">))</span>
        <span class="n">emulation_env_config</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">emulation_record</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">emulation_env_config</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_convert_simulation_record_to_dto</span><span class="p">(</span><span class="n">simulation_record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SimulationEnvConfig</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts an simulation record fetched from the metastore into a DTO</span>

<span class="sd">        :param simulation_record: the record to convert</span>
<span class="sd">        :return: the DTO representing the record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">simulation_config_json_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">simulation_record</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
        <span class="n">simulation_env_config</span><span class="p">:</span> <span class="n">SimulationEnvConfig</span> <span class="o">=</span> <span class="n">SimulationEnvConfig</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span>
            <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">simulation_config_json_str</span><span class="p">))</span>
        <span class="n">simulation_env_config</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">simulation_record</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">simulation_env_config</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_convert_emulation_trace_record_to_dto</span><span class="p">(</span><span class="n">emulation_trace_record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmulationTrace</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts an emulation trace record fetched from the metastore into a DTO</span>

<span class="sd">        :param emulation_trace_record: the record to convert</span>
<span class="sd">        :return: the DTO representing the record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">emulation_trace_json_str</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">emulation_trace_record</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="n">emulation_trace</span><span class="p">:</span> <span class="n">EmulationTrace</span> <span class="o">=</span> <span class="n">EmulationTrace</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">emulation_trace_json_str</span><span class="p">))</span>
        <span class="n">emulation_trace</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">emulation_trace_record</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">emulation_trace</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_convert_emulation_simulation_trace_record_to_dto</span><span class="p">(</span><span class="n">emulation_simulation_trace_record</span><span class="p">)</span> \
            <span class="o">-&gt;</span> <span class="n">EmulationSimulationTrace</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts an emulation-simulkation trace record fetched from the metastore into a DTO</span>

<span class="sd">        :param emulation_simulation_trace_record: the record to convert</span>
<span class="sd">        :return: the DTO representing the record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">emulation_simulation_trace_record</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">emulation_trace_id</span> <span class="o">=</span> <span class="n">emulation_simulation_trace_record</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">simulation_trace_id</span> <span class="o">=</span> <span class="n">emulation_simulation_trace_record</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">emulation_trace</span> <span class="o">=</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">get_emulation_trace</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">emulation_trace_id</span><span class="p">)</span>
        <span class="n">simulation_trace</span> <span class="o">=</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">get_simulation_trace</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">simulation_trace_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">emulation_trace</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find an emulation trace with id: </span><span class="si">{</span><span class="n">emulation_trace_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">simulation_trace</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find a simulation trace with id: </span><span class="si">{</span><span class="n">simulation_trace_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">emulation_simulation_trace</span> <span class="o">=</span> <span class="n">EmulationSimulationTrace</span><span class="p">(</span><span class="n">emulation_trace</span><span class="o">=</span><span class="n">emulation_trace</span><span class="p">,</span>
                                                              <span class="n">simulation_trace</span><span class="o">=</span><span class="n">simulation_trace</span><span class="p">)</span>
        <span class="n">emulation_simulation_trace</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span>
        <span class="k">return</span> <span class="n">emulation_simulation_trace</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_convert_simulation_trace_record_to_dto</span><span class="p">(</span><span class="n">simulation_trace_record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SimulationTrace</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts an emulation trace record fetched from the metastore into a DTO</span>

<span class="sd">        :param simulation_trace_record: the record to convert</span>
<span class="sd">        :return: the DTO representing the record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">simulation_trace_json_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">simulation_trace_record</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
        <span class="n">simulation_trace</span><span class="p">:</span> <span class="n">SimulationTrace</span> <span class="o">=</span> <span class="n">SimulationTrace</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">simulation_trace_json_str</span><span class="p">))</span>
        <span class="n">simulation_trace</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">simulation_trace_record</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">simulation_trace</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_convert_emulation_statistics_record_to_dto</span><span class="p">(</span><span class="n">emulation_statistics_record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmulationStatistics</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts an emulation statistics record fetched from the metastore into a DTO</span>

<span class="sd">        :param emulation_statistics_record: the record to convert</span>
<span class="sd">        :return: the DTO representing the record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">emulation_statistics_json_str</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">emulation_statistics_record</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="n">emulation_statistics</span><span class="p">:</span> <span class="n">EmulationStatistics</span> <span class="o">=</span> <span class="n">EmulationStatistics</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span>
            <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">emulation_statistics_json_str</span><span class="p">,</span>
                       <span class="n">object_hook</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="p">{</span><span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span>
                                              <span class="k">else</span> <span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()}))</span>
        <span class="n">emulation_statistics</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">emulation_statistics_record</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">emulation_statistics</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_convert_emulation_image_record_to_tuple</span><span class="p">(</span><span class="n">emulation_image_record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts an emulation image record fetched from the metastore into bytes</span>

<span class="sd">        :param emulation_image_record: the record to convert</span>
<span class="sd">        :return: a tuple (emulation name, image bytes)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">emulation_name</span> <span class="o">=</span> <span class="n">emulation_image_record</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">image_bytes</span> <span class="o">=</span> <span class="n">emulation_image_record</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">emulation_name</span><span class="p">,</span> <span class="n">image_bytes</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_convert_simulation_image_record_to_tuple</span><span class="p">(</span><span class="n">simulation_image_record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts a simulation image record fetched from the metastore into bytes</span>

<span class="sd">        :param simulation_image_record: the record to convert</span>
<span class="sd">        :return: a tuple (emulation name, image bytes)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">emulation_name</span> <span class="o">=</span> <span class="n">simulation_image_record</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">image_bytes</span> <span class="o">=</span> <span class="n">simulation_image_record</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">emulation_name</span><span class="p">,</span> <span class="n">image_bytes</span>

<div class="viewcode-block" id="MetastoreFacade.install_emulation"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.install_emulation">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">install_emulation</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="n">EmulationEnvConfig</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Installs the emulation configuration in the metastore</span>

<span class="sd">        :param config: the config to install</span>
<span class="sd">        :return: id of the created row or None if the installation failed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Installing emulation:</span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> in the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Need to manually set the ID since CITUS does not handle serial columns</span>
                    <span class="c1"># on distributed tables properly</span>
                    <span class="nb">id</span> <span class="o">=</span> <span class="n">GeneralUtil</span><span class="o">.</span><span class="n">get_latest_table_id</span><span class="p">(</span><span class="n">cur</span><span class="o">=</span><span class="n">cur</span><span class="p">,</span>
                                                         <span class="n">table_name</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EMULATIONS_TABLE</span><span class="p">)</span>
                    <span class="n">config_json_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
                    <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INSERT INTO </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EMULATIONS_TABLE</span><span class="si">}</span><span class="s2"> (id, name, config) &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;VALUES (%s, %s, %s) RETURNING id&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">config_json_str</span><span class="p">))</span>
                    <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                    <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                    <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Emulation </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> installed successfully&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">id_of_new_row</span>
                <span class="k">except</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">UniqueViolation</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Emulation </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> is already installed &quot;</span>
                                                         <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="w"> </span><span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="MetastoreFacade.uninstall_emulation"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.uninstall_emulation">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">uninstall_emulation</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="n">EmulationEnvConfig</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Uninstalls the emulation configuration in the metastore</span>

<span class="sd">        :param config: the config to uninstall</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Uninstalling emulation:</span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> from the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DELETE FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EMULATIONS_TABLE</span><span class="si">}</span><span class="s2"> WHERE name = %s&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">name</span><span class="p">,))</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Emulation </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> uninstalled successfully&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="MetastoreFacade.install_simulation"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.install_simulation">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">install_simulation</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="n">SimulationEnvConfig</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Installs the simulation configuration in the metastore</span>

<span class="sd">        :param config: the config to install</span>
<span class="sd">        :return: id of the created row</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Installing simulation:</span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> in the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Need to manually set the ID since CITUS does not handle serial columns</span>
                    <span class="c1"># on distributed tables properly</span>
                    <span class="nb">id</span> <span class="o">=</span> <span class="n">GeneralUtil</span><span class="o">.</span><span class="n">get_latest_table_id</span><span class="p">(</span><span class="n">cur</span><span class="o">=</span><span class="n">cur</span><span class="p">,</span>
                                                         <span class="n">table_name</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">SIMULATIONS_TABLE</span><span class="p">)</span>
                    <span class="n">config_json_str</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">to_json_str</span><span class="p">()</span>
                    <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INSERT INTO </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">SIMULATIONS_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;(id, name, config) &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;VALUES (%s, %s, %s) RETURNING id&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">config_json_str</span><span class="p">))</span>
                    <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                    <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                    <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Simulation </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> installed successfully&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">id_of_new_row</span>
                <span class="k">except</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">UniqueViolation</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Simulation </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> is already installed, &quot;</span>
                                                         <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="w"> </span><span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="MetastoreFacade.uninstall_simulation"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.uninstall_simulation">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">uninstall_simulation</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="n">SimulationEnvConfig</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Uninstalls the simulation configuration in the metastore</span>

<span class="sd">        :param config: the config to uninstall</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Uninstalling simulation:</span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> from the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DELETE FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">SIMULATIONS_TABLE</span><span class="si">}</span><span class="s2"> WHERE name = %s&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">name</span><span class="p">,))</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Simulation </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> uninstalled successfully&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetastoreFacade.save_emulation_trace"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.save_emulation_trace">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">save_emulation_trace</span><span class="p">(</span><span class="n">emulation_trace</span><span class="p">:</span> <span class="n">EmulationTrace</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves a trace from the emulation</span>

<span class="sd">        :param emulation_trace: the emulation trace to save</span>
<span class="sd">        :return: id of the created record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Installing emulation trace for &quot;</span>
                                             <span class="sa">f</span><span class="s2">&quot;emulation:</span><span class="si">{</span><span class="n">emulation_trace</span><span class="o">.</span><span class="n">emulation_name</span><span class="si">}</span><span class="s2"> in the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="c1"># Need to manually set the ID since CITUS does not handle serial columns on distributed tables properly</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">GeneralUtil</span><span class="o">.</span><span class="n">get_latest_table_id</span><span class="p">(</span><span class="n">cur</span><span class="o">=</span><span class="n">cur</span><span class="p">,</span>
                                                     <span class="n">table_name</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EMULATION_TRACES_TABLE</span><span class="p">)</span>
                <span class="n">config_json_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">emulation_trace</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
                <span class="c1"># Need to compress due to postgres size limits</span>
                <span class="n">compressed_json_str</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">config_json_str</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INSERT INTO </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EMULATION_TRACES_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;(id, emulation_name, trace) &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;VALUES (%s, %s, %s) RETURNING id&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">emulation_trace</span><span class="o">.</span><span class="n">emulation_name</span><span class="p">,</span>
                                                                  <span class="n">compressed_json_str</span><span class="p">))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Emulation trace for &quot;</span>
                                                     <span class="sa">f</span><span class="s2">&quot;emulation </span><span class="si">{</span><span class="n">emulation_trace</span><span class="o">.</span><span class="n">emulation_name</span><span class="si">}</span><span class="s2"> saved successfully&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">id_of_new_row</span></div>

<div class="viewcode-block" id="MetastoreFacade.save_emulation_statistic"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.save_emulation_statistic">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">save_emulation_statistic</span><span class="p">(</span><span class="n">emulation_statistics</span><span class="p">:</span> <span class="n">EmulationStatistics</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves a DTO with emulation statistics to the metastore</span>

<span class="sd">        :param emulation_statistics: the emulation statistics to save</span>
<span class="sd">        :return: id of the created record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Installing statistics &quot;</span>
                                             <span class="sa">f</span><span class="s2">&quot;for emulation:</span><span class="si">{</span><span class="n">emulation_statistics</span><span class="o">.</span><span class="n">emulation_name</span><span class="si">}</span><span class="s2"> in the metastore&quot;</span><span class="p">)</span>
        <span class="n">emulation_statistics</span><span class="o">.</span><span class="n">compute_descriptive_statistics_and_distributions</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="c1"># Need to manually set the ID since CITUS does not handle serial columns on distributed tables properly</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">GeneralUtil</span><span class="o">.</span><span class="n">get_latest_table_id</span><span class="p">(</span><span class="n">cur</span><span class="o">=</span><span class="n">cur</span><span class="p">,</span>
                                                     <span class="n">table_name</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EMULATION_STATISTICS_TABLE</span><span class="p">)</span>
                <span class="n">config_json_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">emulation_statistics</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
                <span class="c1"># Need to compress due to postgres size limits</span>
                <span class="n">compressed_json_str</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">config_json_str</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INSERT INTO &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EMULATION_STATISTICS_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;(id, emulation_name, statistics) &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;VALUES (%s, %s, %s) RETURNING id&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">emulation_statistics</span><span class="o">.</span><span class="n">emulation_name</span><span class="p">,</span>
                                                                  <span class="n">compressed_json_str</span><span class="p">))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Statistics for emulation &quot;</span>
                                                     <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">emulation_statistics</span><span class="o">.</span><span class="n">emulation_name</span><span class="si">}</span><span class="s2"> saved successfully&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">id_of_new_row</span></div>

<div class="viewcode-block" id="MetastoreFacade.update_emulation_statistic"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.update_emulation_statistic">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">update_emulation_statistic</span><span class="p">(</span><span class="n">emulation_statistics</span><span class="p">:</span> <span class="n">EmulationStatistics</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates a row with emulation statistic in the metastore</span>

<span class="sd">        :param emulation_statistics: the emulation statistics to save</span>
<span class="sd">        :param id: the id of the row to update</span>
<span class="sd">        :return: id of the created record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Installing statistics &quot;</span>
                                             <span class="sa">f</span><span class="s2">&quot;for emulation:</span><span class="si">{</span><span class="n">emulation_statistics</span><span class="o">.</span><span class="n">emulation_name</span><span class="si">}</span><span class="s2"> in the metastore&quot;</span><span class="p">)</span>
        <span class="n">emulation_statistics</span><span class="o">.</span><span class="n">compute_descriptive_statistics_and_distributions</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">config_json_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">emulation_statistics</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
                <span class="n">compressed_json_str</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">config_json_str</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;UPDATE &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EMULATION_STATISTICS_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot; SET statistics=%s &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;WHERE </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EMULATION_STATISTICS_TABLE</span><span class="si">}</span><span class="s2">.id = %s&quot;</span><span class="p">,</span>
                            <span class="p">(</span><span class="n">compressed_json_str</span><span class="p">,</span> <span class="nb">id</span><span class="p">))</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Statistics for emulation &quot;</span>
                                                     <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">emulation_statistics</span><span class="o">.</span><span class="n">emulation_name</span><span class="si">}</span><span class="s2"> with id </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2"> &quot;</span>
                                                     <span class="sa">f</span><span class="s2">&quot;updated successfully&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetastoreFacade.list_emulation_statistics"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_emulation_statistics">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_emulation_statistics</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">EmulationStatistics</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of emulation statistics in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EMULATION_STATISTICS_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_emulation_statistics_record_to_dto</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">records</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetastoreFacade.list_emulation_statistics_ids"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_emulation_statistics_ids">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_emulation_statistics_ids</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of emulation statistics ids in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT id,emulation_name FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EMULATION_STATISTICS_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span> <span class="n">records</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetastoreFacade.list_emulation_traces"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_emulation_traces">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_emulation_traces</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">EmulationTrace</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of emulation traces in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EMULATION_TRACES_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_emulation_trace_record_to_dto</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">records</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetastoreFacade.list_emulation_traces_ids"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_emulation_traces_ids">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_emulation_traces_ids</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of emulation traces ids in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT id,emulation_name FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EMULATION_TRACES_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span> <span class="n">records</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetastoreFacade.list_emulation_simulation_traces_ids"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_emulation_simulation_traces_ids">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_emulation_simulation_traces_ids</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of emulation-simulation traces ids in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT id FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EMULATION_SIMULATION_TRACES_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">records</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetastoreFacade.list_simulation_traces_ids"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_simulation_traces_ids">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_simulation_traces_ids</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of simulation traces ids in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT id,gym_env FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">SIMULATION_TRACES_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span> <span class="n">records</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetastoreFacade.list_simulation_traces"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_simulation_traces">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_simulation_traces</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">SimulationTrace</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of simulation traces in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">SIMULATION_TRACES_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_simulation_trace_record_to_dto</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">records</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetastoreFacade.remove_simulation_trace"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.remove_simulation_trace">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">remove_simulation_trace</span><span class="p">(</span><span class="n">simulation_trace</span><span class="p">:</span> <span class="n">SimulationTrace</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes a simulation trace from the metastore</span>

<span class="sd">        :param simulation_trace: the simulation trace to remove</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing simulation traec with &quot;</span>
                                             <span class="sa">f</span><span class="s2">&quot;id:</span><span class="si">{</span><span class="n">simulation_trace</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> from the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DELETE FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">SIMULATION_TRACES_TABLE</span><span class="si">}</span><span class="s2"> WHERE id = %s&quot;</span><span class="p">,</span>
                            <span class="p">(</span><span class="n">simulation_trace</span><span class="o">.</span><span class="n">id</span><span class="p">,))</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Simulation trace &quot;</span>
                                                     <span class="sa">f</span><span class="s2">&quot;with id </span><span class="si">{</span><span class="n">simulation_trace</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> deleted successfully&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetastoreFacade.get_emulation_trace"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.get_emulation_trace">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_emulation_trace</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">EmulationTrace</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for fetching an emulation trace with a given id from the metastore</span>

<span class="sd">        :param id: the id of the emulation trace</span>
<span class="sd">        :return: The emulation trace or None if it could not be found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EMULATION_TRACES_TABLE</span><span class="si">}</span><span class="s2"> WHERE id = %s&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">record</span> <span class="o">=</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_emulation_trace_record_to_dto</span><span class="p">(</span><span class="n">emulation_trace_record</span><span class="o">=</span><span class="n">record</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">record</span></div>

<div class="viewcode-block" id="MetastoreFacade.remove_emulation_trace"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.remove_emulation_trace">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">remove_emulation_trace</span><span class="p">(</span><span class="n">emulation_trace</span><span class="p">:</span> <span class="n">EmulationTrace</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes an emulation trace from the metastore</span>

<span class="sd">        :param emulation_trace: the emulation trace to remove</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing simulation traec with &quot;</span>
                                             <span class="sa">f</span><span class="s2">&quot;id:</span><span class="si">{</span><span class="n">emulation_trace</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> from the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DELETE FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EMULATION_TRACES_TABLE</span><span class="si">}</span><span class="s2"> WHERE id = %s&quot;</span><span class="p">,</span>
                            <span class="p">(</span><span class="n">emulation_trace</span><span class="o">.</span><span class="n">id</span><span class="p">,))</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Emulation trace &quot;</span>
                                                     <span class="sa">f</span><span class="s2">&quot;with id </span><span class="si">{</span><span class="n">emulation_trace</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> deleted successfully&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetastoreFacade.remove_emulation_simulation_trace"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.remove_emulation_simulation_trace">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">remove_emulation_simulation_trace</span><span class="p">(</span><span class="n">emulation_simulation_trace</span><span class="p">:</span> <span class="n">EmulationSimulationTrace</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes an emulation-simulation trace from the metastore</span>

<span class="sd">        :param emulation_simulation_trace: the emulation-simulation trace to remove</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing an emulation-simulation trace with &quot;</span>
                                             <span class="sa">f</span><span class="s2">&quot;id:</span><span class="si">{</span><span class="n">emulation_simulation_trace</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> &quot;</span>
                                             <span class="sa">f</span><span class="s2">&quot;from the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DELETE FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EMULATION_SIMULATION_TRACES_TABLE</span><span class="si">}</span><span class="s2"> WHERE id = %s&quot;</span><span class="p">,</span>
                            <span class="p">(</span><span class="n">emulation_simulation_trace</span><span class="o">.</span><span class="n">id</span><span class="p">,))</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Emulation-Simulation trace &quot;</span>
                                                     <span class="sa">f</span><span class="s2">&quot;with id </span><span class="si">{</span><span class="n">emulation_simulation_trace</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> deleted successfully&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetastoreFacade.get_emulation_statistic"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.get_emulation_statistic">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_emulation_statistic</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">EmulationStatistics</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for fetching an emulation satistic with a given id from the metastore</span>

<span class="sd">        :param id: the id of the statistics</span>
<span class="sd">        :return: The emulation statistic or None if it could not be found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EMULATION_STATISTICS_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;WHERE id = %s&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">record</span> <span class="o">=</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_emulation_statistics_record_to_dto</span><span class="p">(</span>
                        <span class="n">emulation_statistics_record</span><span class="o">=</span><span class="n">record</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">record</span></div>

<div class="viewcode-block" id="MetastoreFacade.remove_emulation_statistic"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.remove_emulation_statistic">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">remove_emulation_statistic</span><span class="p">(</span><span class="n">emulation_statistic</span><span class="p">:</span> <span class="n">EmulationStatistics</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes an emulation statistic from the metastore</span>

<span class="sd">        :param emulation_statistic: the emulation statistic to remove</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing emulation statistic with &quot;</span>
                                             <span class="sa">f</span><span class="s2">&quot;id:</span><span class="si">{</span><span class="n">emulation_statistic</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> from the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DELETE FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EMULATION_STATISTICS_TABLE</span><span class="si">}</span><span class="s2"> WHERE id = %s&quot;</span><span class="p">,</span>
                            <span class="p">(</span><span class="n">emulation_statistic</span><span class="o">.</span><span class="n">id</span><span class="p">,))</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Emulation statistic &quot;</span>
                                                     <span class="sa">f</span><span class="s2">&quot;with id </span><span class="si">{</span><span class="n">emulation_statistic</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> deleted successfully&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetastoreFacade.get_simulation_trace"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.get_simulation_trace">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_simulation_trace</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">SimulationTrace</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for fetching a simulation trace with a given id from the metastore</span>

<span class="sd">        :param id: the id of the simulation trace</span>
<span class="sd">        :return: The simulation trace or None if it could not be found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">SIMULATION_TRACES_TABLE</span><span class="si">}</span><span class="s2"> WHERE id = %s&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">record</span> <span class="o">=</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_simulation_trace_record_to_dto</span><span class="p">(</span><span class="n">simulation_trace_record</span><span class="o">=</span><span class="n">record</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">record</span></div>

<div class="viewcode-block" id="MetastoreFacade.save_simulation_trace"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.save_simulation_trace">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">save_simulation_trace</span><span class="p">(</span><span class="n">simulation_trace</span><span class="p">:</span> <span class="n">SimulationTrace</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves a trace from the simulation</span>

<span class="sd">        :param simulation_trace: the simulation trace to save</span>
<span class="sd">        :return: id of the created record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Installing simulation trace &quot;</span>
                                             <span class="sa">f</span><span class="s2">&quot;for simulation env:</span><span class="si">{</span><span class="n">simulation_trace</span><span class="o">.</span><span class="n">simulation_env</span><span class="si">}</span><span class="s2"> &quot;</span>
                                             <span class="sa">f</span><span class="s2">&quot;in the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="c1"># Need to manually set the ID since CITUS does not handle serial columns</span>
                <span class="c1"># on distributed tables properly</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">GeneralUtil</span><span class="o">.</span><span class="n">get_latest_table_id</span><span class="p">(</span><span class="n">cur</span><span class="o">=</span><span class="n">cur</span><span class="p">,</span>
                                                     <span class="n">table_name</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">SIMULATION_TRACES_TABLE</span><span class="p">)</span>
                <span class="n">config_json_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">simulation_trace</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INSERT INTO </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">SIMULATION_TRACES_TABLE</span><span class="si">}</span><span class="s2"> (id, gym_env, trace) &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;VALUES (%s, %s, %s) RETURNING id&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">simulation_trace</span><span class="o">.</span><span class="n">simulation_env</span><span class="p">,</span> <span class="n">config_json_str</span><span class="p">))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Simulation trace for &quot;</span>
                                                     <span class="sa">f</span><span class="s2">&quot;env </span><span class="si">{</span><span class="n">simulation_trace</span><span class="o">.</span><span class="n">simulation_env</span><span class="si">}</span><span class="s2"> &quot;</span>
                                                     <span class="sa">f</span><span class="s2">&quot;saved successfully&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">id_of_new_row</span></div>

<div class="viewcode-block" id="MetastoreFacade.save_emulation_simulation_trace"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.save_emulation_simulation_trace">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">save_emulation_simulation_trace</span><span class="p">(</span><span class="n">emulation_simulation_trace</span><span class="p">:</span> <span class="n">EmulationSimulationTrace</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves an emulation_simulation trace</span>

<span class="sd">        :param emulation_simulation_trace: the emulation trace to save</span>
<span class="sd">        :return: id of the new row</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Installing emulation-simulation trace for &quot;</span>
                                             <span class="sa">f</span><span class="s2">&quot;emulation:</span><span class="si">{</span><span class="n">emulation_simulation_trace</span><span class="o">.</span><span class="n">emulation_trace</span><span class="o">.</span><span class="n">emulation_name</span><span class="si">}</span><span class="s2"> &quot;</span>
                                             <span class="sa">f</span><span class="s2">&quot;and simulation environment: &quot;</span>
                                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">emulation_simulation_trace</span><span class="o">.</span><span class="n">simulation_trace</span><span class="o">.</span><span class="n">simulation_env</span><span class="si">}</span><span class="s2"> in the &quot;</span>
                                             <span class="sa">f</span><span class="s2">&quot;metastore&quot;</span><span class="p">)</span>
        <span class="n">emulation_trace_id</span> <span class="o">=</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">save_emulation_trace</span><span class="p">(</span>
            <span class="n">emulation_trace</span><span class="o">=</span><span class="n">emulation_simulation_trace</span><span class="o">.</span><span class="n">emulation_trace</span><span class="p">)</span>
        <span class="n">simulation_trace_id</span> <span class="o">=</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">save_simulation_trace</span><span class="p">(</span>
            <span class="n">simulation_trace</span><span class="o">=</span><span class="n">emulation_simulation_trace</span><span class="o">.</span><span class="n">simulation_trace</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="c1"># Need to manually set the ID since CITUS does not handle serial columns</span>
                <span class="c1"># on distributed tables properly</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">GeneralUtil</span><span class="o">.</span><span class="n">get_latest_table_id</span><span class="p">(</span>
                    <span class="n">cur</span><span class="o">=</span><span class="n">cur</span><span class="p">,</span> <span class="n">table_name</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EMULATION_SIMULATION_TRACES_TABLE</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INSERT INTO &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EMULATION_SIMULATION_TRACES_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;(id, emulation_trace, simulation_trace) &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;VALUES (%s, %s, %s) RETURNING id&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">emulation_trace_id</span><span class="p">,</span> <span class="n">simulation_trace_id</span><span class="p">))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Emulation-Simulation trace for &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;emulation </span><span class="si">{</span><span class="n">emulation_simulation_trace</span><span class="o">.</span><span class="n">emulation_trace</span><span class="o">.</span><span class="n">emulation_name</span><span class="si">}</span><span class="s2"> &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;and simulation: </span><span class="si">{</span><span class="n">emulation_simulation_trace</span><span class="o">.</span><span class="n">simulation_trace</span><span class="o">.</span><span class="n">simulation_env</span><span class="si">}</span><span class="s2"> saved successfully&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">id_of_new_row</span></div>

<div class="viewcode-block" id="MetastoreFacade.list_emulation_simulation_traces"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_emulation_simulation_traces">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_emulation_simulation_traces</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">EmulationSimulationTrace</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of emulation-simulation traces in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EMULATION_SIMULATION_TRACES_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_emulation_simulation_trace_record_to_dto</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
                                <span class="n">records</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetastoreFacade.get_emulation_simulation_trace"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.get_emulation_simulation_trace">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_emulation_simulation_trace</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">EmulationSimulationTrace</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for fetching a simulation trace with a given id from the metastore</span>

<span class="sd">        :param id: the id of the emulation-simulation trace</span>
<span class="sd">        :return: The emulation-simulation trace or None if it could not be found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EMULATION_SIMULATION_TRACES_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;WHERE id = %s&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">record</span> <span class="o">=</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_emulation_simulation_trace_record_to_dto</span><span class="p">(</span>
                        <span class="n">emulation_simulation_trace_record</span><span class="o">=</span><span class="n">record</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">record</span></div>

<div class="viewcode-block" id="MetastoreFacade.save_emulation_image"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.save_emulation_image">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">save_emulation_image</span><span class="p">(</span><span class="n">img</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">emulation_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves the image of an emulation in the metastore</span>

<span class="sd">        :param img: the image data to save</span>
<span class="sd">        :param emulation_name: the name of the emulation</span>
<span class="sd">        :return: id of the created row</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saving image for emulation:</span><span class="si">{</span><span class="n">emulation_name</span><span class="si">}</span><span class="s2"> in the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Need to manually set the ID since CITUS does not handle serial columns</span>
                    <span class="c1"># on distributed tables properly</span>
                    <span class="nb">id</span> <span class="o">=</span> <span class="n">GeneralUtil</span><span class="o">.</span><span class="n">get_latest_table_id</span><span class="p">(</span><span class="n">cur</span><span class="o">=</span><span class="n">cur</span><span class="p">,</span>
                                                         <span class="n">table_name</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EMULATION_IMAGES_TABLE</span><span class="p">)</span>
                    <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INSERT INTO </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EMULATION_IMAGES_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;(id, emulation_name, image) VALUES (%s, %s, %s) RETURNING id&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,</span>
                                                                                                  <span class="n">emulation_name</span><span class="p">,</span> <span class="n">img</span><span class="p">))</span>
                    <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                    <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                    <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saved image for emulation </span><span class="si">{</span><span class="n">emulation_name</span><span class="si">}</span><span class="s2"> successfully&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">id_of_new_row</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;There was an error saving an image &quot;</span>
                                                           <span class="sa">f</span><span class="s2">&quot;for emulation </span><span class="si">{</span><span class="n">emulation_name</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="w"> </span><span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetastoreFacade.list_emulation_images"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_emulation_images">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_emulation_images</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of emulation names and images in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EMULATION_IMAGES_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_emulation_image_record_to_tuple</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">records</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetastoreFacade.get_emulation_image"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.get_emulation_image">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_emulation_image</span><span class="p">(</span><span class="n">emulation_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for fetching the image of a given emulation</span>

<span class="sd">        :param emulation_name: the name of the emulatin to fetch the image for</span>
<span class="sd">        :return: The simulation trace or None if it could not be found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EMULATION_IMAGES_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;WHERE emulation_name = %s&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">emulation_name</span><span class="p">,))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">record</span> <span class="o">=</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_emulation_image_record_to_tuple</span><span class="p">(</span><span class="n">emulation_image_record</span><span class="o">=</span><span class="n">record</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">record</span></div>

<div class="viewcode-block" id="MetastoreFacade.delete_all"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.delete_all">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">delete_all</span><span class="p">(</span><span class="n">table</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deletes all rows in the metastore from a given table</span>

<span class="sd">        :param table: the table to delete from</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Deleting all traces from table &quot;</span>
                                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DELETE FROM </span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;All traces deleted from table &quot;</span>
                                                     <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2"> successfully&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetastoreFacade.save_simulation_image"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.save_simulation_image">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">save_simulation_image</span><span class="p">(</span><span class="n">img</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">simulation_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves the image of a simulation in the metastore</span>

<span class="sd">        :param img: the image data to save</span>
<span class="sd">        :param simulation_name: the name of the simulation</span>
<span class="sd">        :return: id of the created row</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saving image for simulation:</span><span class="si">{</span><span class="n">simulation_name</span><span class="si">}</span><span class="s2"> in the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Need to manually set the ID since CITUS does not handle serial columns</span>
                    <span class="c1"># on distributed tables properly</span>
                    <span class="nb">id</span> <span class="o">=</span> <span class="n">GeneralUtil</span><span class="o">.</span><span class="n">get_latest_table_id</span><span class="p">(</span><span class="n">cur</span><span class="o">=</span><span class="n">cur</span><span class="p">,</span>
                                                         <span class="n">table_name</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">SIMULATION_IMAGES_TABLE</span><span class="p">)</span>
                    <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INSERT INTO </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">SIMULATION_IMAGES_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;(id, simulation_name, image) VALUES (%s, %s, %s) RETURNING id&quot;</span><span class="p">,</span>
                                <span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">simulation_name</span><span class="p">,</span> <span class="n">img</span><span class="p">))</span>
                    <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                    <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                    <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saved image for simulation </span><span class="si">{</span><span class="n">simulation_name</span><span class="si">}</span><span class="s2"> successfully&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">id_of_new_row</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;There was an error saving an image &quot;</span>
                                                           <span class="sa">f</span><span class="s2">&quot;for simulation </span><span class="si">{</span><span class="n">simulation_name</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="w"> </span><span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="MetastoreFacade.list_simulation_images"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_simulation_images">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_simulation_images</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of simulation names and images in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">SIMULATION_IMAGES_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_simulation_image_record_to_tuple</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">records</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetastoreFacade.get_simulation_image"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.get_simulation_image">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_simulation_image</span><span class="p">(</span><span class="n">simulation_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for fetching the image of a given simulation</span>

<span class="sd">        :param simulation_name: the name of the simulation to fetch the image for</span>
<span class="sd">        :return: The simulation trace or None if it could not be found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">SIMULATION_IMAGES_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;WHERE simulation_name = %s&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">simulation_name</span><span class="p">,))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">record</span> <span class="o">=</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_simulation_image_record_to_tuple</span><span class="p">(</span><span class="n">simulation_image_record</span><span class="o">=</span><span class="n">record</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">record</span></div>

<div class="viewcode-block" id="MetastoreFacade.save_experiment_execution"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.save_experiment_execution">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">save_experiment_execution</span><span class="p">(</span><span class="n">experiment_execution</span><span class="p">:</span> <span class="n">ExperimentExecution</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves an experiment execution to the metastore</span>

<span class="sd">        :param experiment_execution: the experiment execution to save</span>
<span class="sd">        :return: id of the created record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Installing experiment exection for emulation: &quot;</span>
                                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">experiment_execution</span><span class="o">.</span><span class="n">emulation_name</span><span class="si">}</span><span class="s2"> &quot;</span>
                                             <span class="sa">f</span><span class="s2">&quot;and simulation: </span><span class="si">{</span><span class="n">experiment_execution</span><span class="o">.</span><span class="n">simulation_name</span><span class="si">}</span><span class="s2"> &quot;</span>
                                             <span class="sa">f</span><span class="s2">&quot;in the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="c1"># Need to manually set the ID since CITUS does not handle serial columns</span>
                <span class="c1"># on distributed tables properly</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">GeneralUtil</span><span class="o">.</span><span class="n">get_latest_table_id</span><span class="p">(</span><span class="n">cur</span><span class="o">=</span><span class="n">cur</span><span class="p">,</span>
                                                     <span class="n">table_name</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EXPERIMENT_EXECUTIONS_TABLE</span><span class="p">)</span>
                <span class="n">config_json_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">experiment_execution</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INSERT INTO </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EXPERIMENT_EXECUTIONS_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;(id, execution, simulation_name, emulation_name) &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;VALUES (%s, %s, %s, %s) RETURNING id&quot;</span><span class="p">,</span>
                            <span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">config_json_str</span><span class="p">,</span> <span class="n">experiment_execution</span><span class="o">.</span><span class="n">simulation_name</span><span class="p">,</span>
                             <span class="n">experiment_execution</span><span class="o">.</span><span class="n">emulation_name</span><span class="p">))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Experiment execution for &quot;</span>
                                                     <span class="sa">f</span><span class="s2">&quot;emulation </span><span class="si">{</span><span class="n">experiment_execution</span><span class="o">.</span><span class="n">emulation_name</span><span class="si">}</span><span class="s2"> &quot;</span>
                                                     <span class="sa">f</span><span class="s2">&quot;and simulation </span><span class="si">{</span><span class="n">experiment_execution</span><span class="o">.</span><span class="n">simulation_name</span><span class="si">}</span><span class="s2"> &quot;</span>
                                                     <span class="sa">f</span><span class="s2">&quot;saved successfully&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">id_of_new_row</span></div>

<div class="viewcode-block" id="MetastoreFacade.list_experiment_executions"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_experiment_executions">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_experiment_executions</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ExperimentExecution</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of emulation traces in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EXPERIMENT_EXECUTIONS_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_experiment_execution_record_to_dto</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">records</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetastoreFacade.list_experiment_executions_ids"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_experiment_executions_ids">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_experiment_executions_ids</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of experiment execution ids in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT id,simulation_name,emulation_name FROM &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EXPERIMENT_EXECUTIONS_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])),</span> <span class="n">records</span><span class="p">))</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_convert_experiment_execution_record_to_dto</span><span class="p">(</span><span class="n">experiment_execution_record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ExperimentExecution</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts an experiment execution record fetched from the metastore into a DTO</span>

<span class="sd">        :param experiment_execution_record: the record to convert</span>
<span class="sd">        :return: the DTO representing the record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">experiment_execution_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">experiment_execution_record</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
        <span class="n">experiment_execution</span><span class="p">:</span> <span class="n">ExperimentExecution</span> <span class="o">=</span> <span class="n">ExperimentExecution</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">experiment_execution_json</span><span class="p">))</span>
        <span class="n">experiment_execution</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">experiment_execution_record</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">experiment_execution</span>

<div class="viewcode-block" id="MetastoreFacade.get_experiment_execution"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.get_experiment_execution">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_experiment_execution</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">ExperimentExecution</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for fetching an experiment execution with a given id from the metastore</span>

<span class="sd">        :param id: the id of the emulation trace</span>
<span class="sd">        :return: The emulation trace or None if it could not be found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EXPERIMENT_EXECUTIONS_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;WHERE id = %s&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">record</span> <span class="o">=</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_experiment_execution_record_to_dto</span><span class="p">(</span>
                        <span class="n">experiment_execution_record</span><span class="o">=</span><span class="n">record</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">record</span></div>

<div class="viewcode-block" id="MetastoreFacade.remove_experiment_execution"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.remove_experiment_execution">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">remove_experiment_execution</span><span class="p">(</span><span class="n">experiment_execution</span><span class="p">:</span> <span class="n">ExperimentExecution</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes an experiment execution from the metastore</span>

<span class="sd">        :param experiment_execution: the experiment execution to remove</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing experiment execution with &quot;</span>
                                             <span class="sa">f</span><span class="s2">&quot;id:</span><span class="si">{</span><span class="n">experiment_execution</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> from the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DELETE FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EXPERIMENT_EXECUTIONS_TABLE</span><span class="si">}</span><span class="s2"> WHERE id = %s&quot;</span><span class="p">,</span>
                            <span class="p">(</span><span class="n">experiment_execution</span><span class="o">.</span><span class="n">id</span><span class="p">,))</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Experiment execution &quot;</span>
                                                     <span class="sa">f</span><span class="s2">&quot;with id </span><span class="si">{</span><span class="n">experiment_execution</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> deleted successfully&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetastoreFacade.list_multi_threshold_stopping_policies"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_multi_threshold_stopping_policies">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_multi_threshold_stopping_policies</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">MultiThresholdStoppingPolicy</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of Multi-threshold stopping policies in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">MULTI_THRESHOLD_STOPPING_POLICIES_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_multi_threshold_stopping_policy_record_to_dto</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">records</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetastoreFacade.list_multi_threshold_stopping_policies_ids"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_multi_threshold_stopping_policies_ids">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_multi_threshold_stopping_policies_ids</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of Multi-threshold stopping policies ids in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT id,simulation_name FROM &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">MULTI_THRESHOLD_STOPPING_POLICIES_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span> <span class="n">records</span><span class="p">))</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_convert_multi_threshold_stopping_policy_record_to_dto</span><span class="p">(</span><span class="n">multi_threshold_stopping_policy_record</span><span class="p">)</span> \
            <span class="o">-&gt;</span> <span class="n">MultiThresholdStoppingPolicy</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts a Multi-threshold stopping policy record fetched from the metastore into a DTO</span>

<span class="sd">        :param multi_threshold_stopping_policy_record: the record to convert</span>
<span class="sd">        :return: the DTO representing the record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">multi_threshold_stopping_policy_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">multi_threshold_stopping_policy_record</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                                                          <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
        <span class="n">multi_threshold_stopping_policy</span><span class="p">:</span> <span class="n">MultiThresholdStoppingPolicy</span> <span class="o">=</span> <span class="n">MultiThresholdStoppingPolicy</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span>
            <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">multi_threshold_stopping_policy_json</span><span class="p">))</span>
        <span class="n">multi_threshold_stopping_policy</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">multi_threshold_stopping_policy_record</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">multi_threshold_stopping_policy</span>

<div class="viewcode-block" id="MetastoreFacade.get_multi_threshold_stopping_policy"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.get_multi_threshold_stopping_policy">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_multi_threshold_stopping_policy</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">MultiThresholdStoppingPolicy</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for fetching a mult-threshold policy with a given id from the metastore</span>

<span class="sd">        :param id: the id of the multi-threshold policy</span>
<span class="sd">        :return: The mult-threshold policy or None if it could not be found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">MULTI_THRESHOLD_STOPPING_POLICIES_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;WHERE id = %s&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">record</span> <span class="o">=</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_multi_threshold_stopping_policy_record_to_dto</span><span class="p">(</span>
                        <span class="n">multi_threshold_stopping_policy_record</span><span class="o">=</span><span class="n">record</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">record</span></div>

<div class="viewcode-block" id="MetastoreFacade.remove_multi_threshold_stopping_policy"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.remove_multi_threshold_stopping_policy">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">remove_multi_threshold_stopping_policy</span><span class="p">(</span><span class="n">multi_threshold_stopping_policy</span><span class="p">:</span> <span class="n">MultiThresholdStoppingPolicy</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes a multi-threshold stopping policy from the metastore</span>

<span class="sd">        :param multi_threshold_stopping_policy: the policy to remove</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing Multi-threshold stopping policy with &quot;</span>
                                             <span class="sa">f</span><span class="s2">&quot;id:</span><span class="si">{</span><span class="n">multi_threshold_stopping_policy</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> from the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DELETE FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">MULTI_THRESHOLD_STOPPING_POLICIES_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;WHERE id = %s&quot;</span><span class="p">,</span>
                            <span class="p">(</span><span class="n">multi_threshold_stopping_policy</span><span class="o">.</span><span class="n">id</span><span class="p">,))</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Multi-threshold stopping policy &quot;</span>
                                                     <span class="sa">f</span><span class="s2">&quot;with id </span><span class="si">{</span><span class="n">multi_threshold_stopping_policy</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> &quot;</span>
                                                     <span class="sa">f</span><span class="s2">&quot;deleted successfully&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetastoreFacade.save_multi_threshold_stopping_policy"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.save_multi_threshold_stopping_policy">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">save_multi_threshold_stopping_policy</span><span class="p">(</span><span class="n">multi_threshold_stopping_policy</span><span class="p">:</span> <span class="n">MultiThresholdStoppingPolicy</span><span class="p">)</span> \
            <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves a multi-threshold stopping policy to the metastore</span>

<span class="sd">        :param multi_threshold_stopping_policy: the policy to save</span>
<span class="sd">        :return: id of the created record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Installing a multi-threshold stopping policy in the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="c1"># Need to manually set the ID since CITUS does not handle serial columns</span>
                <span class="c1"># on distributed tables properly</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">GeneralUtil</span><span class="o">.</span><span class="n">get_latest_table_id</span><span class="p">(</span>
                    <span class="n">cur</span><span class="o">=</span><span class="n">cur</span><span class="p">,</span> <span class="n">table_name</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">MULTI_THRESHOLD_STOPPING_POLICIES_TABLE</span><span class="p">)</span>
                <span class="n">policy_json_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">multi_threshold_stopping_policy</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                             <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INSERT INTO </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">MULTI_THRESHOLD_STOPPING_POLICIES_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;(id, policy, simulation_name) &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;VALUES (%s, %s, %s) RETURNING id&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">policy_json_str</span><span class="p">,</span>
                                                                  <span class="n">multi_threshold_stopping_policy</span><span class="o">.</span><span class="n">simulation_name</span><span class="p">))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Multi-threshold policy saved successfully&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">id_of_new_row</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_convert_training_job_record_to_dto</span><span class="p">(</span><span class="n">training_job_record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TrainingJobConfig</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts a training job record fetched from the metastore into a DTO</span>

<span class="sd">        :param training_job_record: the record to convert</span>
<span class="sd">        :return: the DTO representing the record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tranining_job_config_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">training_job_record</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
        <span class="n">training_job_config</span><span class="p">:</span> <span class="n">TrainingJobConfig</span> <span class="o">=</span> <span class="n">TrainingJobConfig</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">tranining_job_config_json</span><span class="p">))</span>
        <span class="n">training_job_config</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">training_job_record</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">training_job_config</span>

<div class="viewcode-block" id="MetastoreFacade.list_training_jobs"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_training_jobs">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_training_jobs</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">TrainingJobConfig</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of training jobs in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">TRAINING_JOBS_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_training_job_record_to_dto</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">records</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetastoreFacade.list_training_jobs_ids"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_training_jobs_ids">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_training_jobs_ids</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of training job ids in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT id,simulation_name,emulation_name,pid FROM &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">TRAINING_JOBS_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">])),</span> <span class="n">records</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetastoreFacade.get_training_job_config"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.get_training_job_config">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_training_job_config</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">TrainingJobConfig</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for fetching a training job config with a given id from the metastore</span>

<span class="sd">        :param id: the id of the training job config</span>
<span class="sd">        :return: The trainign job config or None if it could not be found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">TRAINING_JOBS_TABLE</span><span class="si">}</span><span class="s2"> WHERE id = %s&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">record</span> <span class="o">=</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_training_job_record_to_dto</span><span class="p">(</span><span class="n">training_job_record</span><span class="o">=</span><span class="n">record</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">record</span></div>

<div class="viewcode-block" id="MetastoreFacade.save_training_job"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.save_training_job">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">save_training_job</span><span class="p">(</span><span class="n">training_job</span><span class="p">:</span> <span class="n">TrainingJobConfig</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves a training job to the metastore</span>

<span class="sd">        :param training_job: the training job to save</span>
<span class="sd">        :return: id of the created record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Saving a training job in the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">GeneralUtil</span><span class="o">.</span><span class="n">get_latest_table_id</span><span class="p">(</span><span class="n">cur</span><span class="o">=</span><span class="n">cur</span><span class="p">,</span>
                                                     <span class="n">table_name</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">TRAINING_JOBS_TABLE</span><span class="p">)</span>
                <span class="n">training_job_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">training_job</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
                <span class="n">emulation_name</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="n">training_job</span><span class="o">.</span><span class="n">emulation_env_name</span>
                <span class="k">if</span> <span class="n">emulation_name</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="n">emulation_name</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INSERT INTO </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">TRAINING_JOBS_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;(id, config, simulation_name, emulation_name, pid) &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;VALUES (%s, %s, %s, %s, %s) RETURNING id&quot;</span><span class="p">,</span>
                            <span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">training_job_str</span><span class="p">,</span> <span class="n">training_job</span><span class="o">.</span><span class="n">simulation_env_name</span><span class="p">,</span> <span class="n">emulation_name</span><span class="p">,</span> <span class="n">training_job</span><span class="o">.</span><span class="n">pid</span><span class="p">))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Training job saved successfully&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">id_of_new_row</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_convert_data_collection_job_record_to_dto</span><span class="p">(</span><span class="n">data_collection_job_record</span><span class="p">)</span> <span class="o">-&gt;</span> \
            <span class="n">DataCollectionJobConfig</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts a data collection job record fetched from the metastore into a DTO</span>

<span class="sd">        :param data_collection_job_record: the record to convert</span>
<span class="sd">        :return: the DTO representing the record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data_collection_job_config_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data_collection_job_record</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                                                     <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
        <span class="n">data_collection_job_config</span><span class="p">:</span> <span class="n">DataCollectionJobConfig</span> <span class="o">=</span> \
            <span class="n">DataCollectionJobConfig</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data_collection_job_config_json</span><span class="p">))</span>
        <span class="n">data_collection_job_config</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">data_collection_job_record</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">data_collection_job_config</span>

<div class="viewcode-block" id="MetastoreFacade.list_data_collection_jobs"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_data_collection_jobs">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_data_collection_jobs</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">DataCollectionJobConfig</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of data collection jobs in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DATA_COLLECTION_JOBS_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_data_collection_job_record_to_dto</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">records</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetastoreFacade.list_data_collection_jobs_ids"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_data_collection_jobs_ids">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_data_collection_jobs_ids</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of data collection job ids in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT id,emulation_name,pid FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DATA_COLLECTION_JOBS_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])),</span> <span class="n">records</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetastoreFacade.get_data_collection_job_config"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.get_data_collection_job_config">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_data_collection_job_config</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">DataCollectionJobConfig</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for fetching a data collection job config with a given id from the metastore</span>

<span class="sd">        :param id: the id of the data collection job config</span>
<span class="sd">        :return: The data collection job config or None if it could not be found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DATA_COLLECTION_JOBS_TABLE</span><span class="si">}</span><span class="s2"> WHERE id = %s&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">record</span> <span class="o">=</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_data_collection_job_record_to_dto</span><span class="p">(</span>
                        <span class="n">data_collection_job_record</span><span class="o">=</span><span class="n">record</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">record</span></div>

<div class="viewcode-block" id="MetastoreFacade.save_data_collection_job"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.save_data_collection_job">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">save_data_collection_job</span><span class="p">(</span><span class="n">data_collection_job</span><span class="p">:</span> <span class="n">DataCollectionJobConfig</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves a data collection job to the metastore</span>

<span class="sd">        :param data_collection_job: the data collection job to save</span>
<span class="sd">        :return: id of the created record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Saving a data collection job in the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="c1"># Need to manually set the ID since CITUS does not handle serial columns on distributed tables properly</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">GeneralUtil</span><span class="o">.</span><span class="n">get_latest_table_id</span><span class="p">(</span><span class="n">cur</span><span class="o">=</span><span class="n">cur</span><span class="p">,</span>
                                                     <span class="n">table_name</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DATA_COLLECTION_JOBS_TABLE</span><span class="p">)</span>
                <span class="n">data_collection_job_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data_collection_job</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                                                      <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INSERT INTO </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DATA_COLLECTION_JOBS_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;(id, config, emulation_name, pid) &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;VALUES (%s, %s, %s, %s) RETURNING id&quot;</span><span class="p">,</span>
                            <span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">data_collection_job_json</span><span class="p">,</span> <span class="n">data_collection_job</span><span class="o">.</span><span class="n">emulation_env_name</span><span class="p">,</span>
                             <span class="n">data_collection_job</span><span class="o">.</span><span class="n">pid</span><span class="p">))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Data collection job saved successfully&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">id_of_new_row</span></div>

<div class="viewcode-block" id="MetastoreFacade.update_training_job"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.update_training_job">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">update_training_job</span><span class="p">(</span><span class="n">training_job</span><span class="p">:</span> <span class="n">TrainingJobConfig</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates a training job in the metastore</span>

<span class="sd">        :param training_job: the training job to save</span>
<span class="sd">        :param id: the id of the row to update</span>
<span class="sd">        :return: id of the created record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updating training job with id: </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2"> in the metastore&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">NUM_RETRIES_UPDATE_TRAINING_JOB</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
                    <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                        <span class="n">config_json_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">training_job</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
                        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;UPDATE &quot;</span>
                                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">TRAINING_JOBS_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                                    <span class="sa">f</span><span class="s2">&quot; SET config=%s &quot;</span>
                                    <span class="sa">f</span><span class="s2">&quot;WHERE </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">TRAINING_JOBS_TABLE</span><span class="si">}</span><span class="s2">.id = %s&quot;</span><span class="p">,</span>
                                    <span class="p">(</span><span class="n">config_json_str</span><span class="p">,</span> <span class="nb">id</span><span class="p">))</span>
                        <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Training job with id: </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2"> updated successfully&quot;</span><span class="p">)</span>
                        <span class="k">break</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span></div>

<div class="viewcode-block" id="MetastoreFacade.update_experiment_execution"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.update_experiment_execution">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">update_experiment_execution</span><span class="p">(</span><span class="n">experiment_execution</span><span class="p">:</span> <span class="n">ExperimentExecution</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates an experiment execution in the metastore</span>

<span class="sd">        :param experiment_execution: the experiment execution to update</span>
<span class="sd">        :param id: the id of the row to update</span>
<span class="sd">        :return: id of the created record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updating experiment execution with id: </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2"> in the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">config_json_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">experiment_execution</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;UPDATE &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EXPERIMENT_EXECUTIONS_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot; SET execution=%s &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;WHERE </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EXPERIMENT_EXECUTIONS_TABLE</span><span class="si">}</span><span class="s2">.id = %s&quot;</span><span class="p">,</span>
                            <span class="p">(</span><span class="n">config_json_str</span><span class="p">,</span> <span class="nb">id</span><span class="p">))</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Experiment execution with id: </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2"> updated successfully&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetastoreFacade.update_data_collection_job"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.update_data_collection_job">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">update_data_collection_job</span><span class="p">(</span><span class="n">data_collection_job</span><span class="p">:</span> <span class="n">DataCollectionJobConfig</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates a data collection job in the metastore</span>

<span class="sd">        :param training_job: the training job to save</span>
<span class="sd">        :param id: the id of the row to update</span>
<span class="sd">        :return: id of the created record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updating data collection job with id: </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2"> in the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">config_json_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data_collection_job</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;UPDATE &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DATA_COLLECTION_JOBS_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot; SET config=%s &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;WHERE </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DATA_COLLECTION_JOBS_TABLE</span><span class="si">}</span><span class="s2">.id = %s&quot;</span><span class="p">,</span>
                            <span class="p">(</span><span class="n">config_json_str</span><span class="p">,</span> <span class="nb">id</span><span class="p">))</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data collection job with id: </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2"> updated successfully&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetastoreFacade.remove_training_job"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.remove_training_job">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">remove_training_job</span><span class="p">(</span><span class="n">training_job</span><span class="p">:</span> <span class="n">TrainingJobConfig</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes a training job from the metastore</span>

<span class="sd">        :param config: the config to uninstall</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing training job with id:</span><span class="si">{</span><span class="n">training_job</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> from the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DELETE FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">TRAINING_JOBS_TABLE</span><span class="si">}</span><span class="s2"> WHERE id = %s&quot;</span><span class="p">,</span>
                            <span class="p">(</span><span class="n">training_job</span><span class="o">.</span><span class="n">id</span><span class="p">,))</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Training job with id </span><span class="si">{</span><span class="n">training_job</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> deleted successfully&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetastoreFacade.remove_data_collection_job"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.remove_data_collection_job">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">remove_data_collection_job</span><span class="p">(</span><span class="n">data_collection_job</span><span class="p">:</span> <span class="n">DataCollectionJobConfig</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes a data collection job from the metastore</span>

<span class="sd">        :param config: the config to uninstall</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing data collection job with &quot;</span>
                                             <span class="sa">f</span><span class="s2">&quot;id:</span><span class="si">{</span><span class="n">data_collection_job</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> from the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DELETE FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DATA_COLLECTION_JOBS_TABLE</span><span class="si">}</span><span class="s2"> WHERE id = %s&quot;</span><span class="p">,</span>
                            <span class="p">(</span><span class="n">data_collection_job</span><span class="o">.</span><span class="n">id</span><span class="p">,))</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Training job with &quot;</span>
                                                     <span class="sa">f</span><span class="s2">&quot;id </span><span class="si">{</span><span class="n">data_collection_job</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> deleted successfully&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetastoreFacade.list_ppo_policies"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_ppo_policies">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_ppo_policies</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">PPOPolicy</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of PPO policies in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PPO_POLICIES_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_ppo_policy_record_to_dto</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">records</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetastoreFacade.list_ppo_policies_ids"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_ppo_policies_ids">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_ppo_policies_ids</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of PPO policies ids in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT id,simulation_name FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PPO_POLICIES_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span> <span class="n">records</span><span class="p">))</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_convert_ppo_policy_record_to_dto</span><span class="p">(</span><span class="n">ppo_policy_record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PPOPolicy</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts a PPO policy record fetched from the metastore into a DTO</span>

<span class="sd">        :param ppo_policy_record: the record to convert</span>
<span class="sd">        :return: the DTO representing the record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ppo_policy_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">ppo_policy_record</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
        <span class="n">ppo_policy</span><span class="p">:</span> <span class="n">PPOPolicy</span> <span class="o">=</span> <span class="n">PPOPolicy</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">ppo_policy_json</span><span class="p">))</span>
        <span class="n">ppo_policy</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">ppo_policy_record</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">ppo_policy</span>

<div class="viewcode-block" id="MetastoreFacade.get_ppo_policy"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.get_ppo_policy">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_ppo_policy</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">PPOPolicy</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for fetching a PPO policy with a given id from the metastore</span>

<span class="sd">        :param id: the id of the PPO policy</span>
<span class="sd">        :return: The PPO policy or None if it could not be found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PPO_POLICIES_TABLE</span><span class="si">}</span><span class="s2"> WHERE id = %s&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">record</span> <span class="o">=</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_ppo_policy_record_to_dto</span><span class="p">(</span><span class="n">ppo_policy_record</span><span class="o">=</span><span class="n">record</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">record</span></div>

<div class="viewcode-block" id="MetastoreFacade.remove_ppo_policy"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.remove_ppo_policy">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">remove_ppo_policy</span><span class="p">(</span><span class="n">ppo_policy</span><span class="p">:</span> <span class="n">PPOPolicy</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes a PPO policy from the metastore</span>

<span class="sd">        :param ppo_policy: the policy to remove</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing ppo policy with &quot;</span>
                                             <span class="sa">f</span><span class="s2">&quot;id:</span><span class="si">{</span><span class="n">ppo_policy</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> from the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DELETE FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PPO_POLICIES_TABLE</span><span class="si">}</span><span class="s2"> WHERE id = %s&quot;</span><span class="p">,</span>
                            <span class="p">(</span><span class="n">ppo_policy</span><span class="o">.</span><span class="n">id</span><span class="p">,))</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PPO policy &quot;</span>
                                                     <span class="sa">f</span><span class="s2">&quot;with id </span><span class="si">{</span><span class="n">ppo_policy</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> deleted successfully&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetastoreFacade.save_ppo_policy"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.save_ppo_policy">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">save_ppo_policy</span><span class="p">(</span><span class="n">ppo_policy</span><span class="p">:</span> <span class="n">PPOPolicy</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves a PPO policy to the metastore</span>

<span class="sd">        :param ppo_policy: the policy to save</span>
<span class="sd">        :return: id of the created record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Installing PPO policy in the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="c1"># Need to manually set the ID since CITUS does not handle serial columns</span>
                <span class="c1"># on distributed tables properly</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">GeneralUtil</span><span class="o">.</span><span class="n">get_latest_table_id</span><span class="p">(</span><span class="n">cur</span><span class="o">=</span><span class="n">cur</span><span class="p">,</span>
                                                     <span class="n">table_name</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PPO_POLICIES_TABLE</span><span class="p">)</span>
                <span class="n">policy_json_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">ppo_policy</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INSERT INTO </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PPO_POLICIES_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;(id, policy, simulation_name) &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;VALUES (%s, %s, %s) RETURNING id&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">policy_json_str</span><span class="p">,</span> <span class="n">ppo_policy</span><span class="o">.</span><span class="n">simulation_name</span><span class="p">))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;PPO policy saved successfully&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">id_of_new_row</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_convert_system_identification_job_record_to_dto</span><span class="p">(</span><span class="n">system_identification_job_record</span><span class="p">)</span> <span class="o">-&gt;</span> \
            <span class="n">SystemIdentificationJobConfig</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts a system identification job record fetched from the metastore into a DTO</span>

<span class="sd">        :param system_identification_job_record: the record to convert</span>
<span class="sd">        :return: the DTO representing the record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">system_identification_job_config_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">system_identification_job_record</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                                                           <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
        <span class="n">system_identification_job_config</span><span class="p">:</span> <span class="n">SystemIdentificationJobConfig</span> <span class="o">=</span> \
            <span class="n">SystemIdentificationJobConfig</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">system_identification_job_config_json</span><span class="p">))</span>
        <span class="n">system_identification_job_config</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">system_identification_job_record</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">system_identification_job_config</span>

<div class="viewcode-block" id="MetastoreFacade.list_system_identification_jobs"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_system_identification_jobs">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_system_identification_jobs</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">SystemIdentificationJobConfig</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of system identification jobs in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">SYSTEM_IDENTIFICATION_JOBS_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_system_identification_job_record_to_dto</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">records</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetastoreFacade.list_system_identification_jobs_ids"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_system_identification_jobs_ids">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_system_identification_jobs_ids</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of system identification job ids in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT id,emulation_name,pid FROM &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">SYSTEM_IDENTIFICATION_JOBS_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])),</span> <span class="n">records</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetastoreFacade.get_system_identification_job_config"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.get_system_identification_job_config">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_system_identification_job_config</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">SystemIdentificationJobConfig</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for fetching a system identification job config with a given id from the metastore</span>

<span class="sd">        :param id: the id of the system identification job config</span>
<span class="sd">        :return: The system identification job config or None if it could not be found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">SYSTEM_IDENTIFICATION_JOBS_TABLE</span><span class="si">}</span><span class="s2"> WHERE id = %s&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">record</span> <span class="o">=</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_system_identification_job_record_to_dto</span><span class="p">(</span>
                        <span class="n">system_identification_job_record</span><span class="o">=</span><span class="n">record</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">record</span></div>

<div class="viewcode-block" id="MetastoreFacade.save_system_identification_job"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.save_system_identification_job">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">save_system_identification_job</span><span class="p">(</span><span class="n">system_identification_job</span><span class="p">:</span> <span class="n">SystemIdentificationJobConfig</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves a system_identification job to the metastore</span>

<span class="sd">        :param system_identification_job: the system identification job to save</span>
<span class="sd">        :return: id of the created record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Saving a system identification job in the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="c1"># Need to manually set the ID since CITUS does not handle serial columns</span>
                <span class="c1"># on distributed tables properly</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">GeneralUtil</span><span class="o">.</span><span class="n">get_latest_table_id</span><span class="p">(</span>
                    <span class="n">cur</span><span class="o">=</span><span class="n">cur</span><span class="p">,</span> <span class="n">table_name</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">SYSTEM_IDENTIFICATION_JOBS_TABLE</span><span class="p">)</span>
                <span class="n">system_identification_job_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">system_identification_job</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                                                            <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INSERT INTO </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">SYSTEM_IDENTIFICATION_JOBS_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;(id, config, emulation_name, pid) &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;VALUES (%s, %s, %s, %s) RETURNING id&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">system_identification_job_json</span><span class="p">,</span>
                                                                      <span class="n">system_identification_job</span><span class="o">.</span><span class="n">emulation_env_name</span><span class="p">,</span>
                                                                      <span class="n">system_identification_job</span><span class="o">.</span><span class="n">pid</span><span class="p">))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;System identification job saved successfully&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">id_of_new_row</span></div>

<div class="viewcode-block" id="MetastoreFacade.update_system_identification_job"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.update_system_identification_job">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">update_system_identification_job</span><span class="p">(</span><span class="n">system_identification_job</span><span class="p">:</span> <span class="n">SystemIdentificationJobConfig</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates a system identification job in the metastore</span>

<span class="sd">        :param system_identification_job: the system identification job to save</span>
<span class="sd">        :param id: the id of the row to update</span>
<span class="sd">        :return: id of the created record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updating system identification job with id: </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2"> in the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">config_json_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">system_identification_job</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                             <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;UPDATE &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">SYSTEM_IDENTIFICATION_JOBS_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot; SET config=%s &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;WHERE </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">SYSTEM_IDENTIFICATION_JOBS_TABLE</span><span class="si">}</span><span class="s2">.id = %s&quot;</span><span class="p">,</span>
                            <span class="p">(</span><span class="n">config_json_str</span><span class="p">,</span> <span class="nb">id</span><span class="p">))</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;System identification job with id: </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2"> updated successfully&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetastoreFacade.remove_system_identification_job"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.remove_system_identification_job">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">remove_system_identification_job</span><span class="p">(</span><span class="n">system_identification_job</span><span class="p">:</span> <span class="n">SystemIdentificationJobConfig</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes a system identification job from the metastore</span>

<span class="sd">        :param system_identification_job: the job to remove</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing system identification job with &quot;</span>
                                             <span class="sa">f</span><span class="s2">&quot;id:</span><span class="si">{</span><span class="n">system_identification_job</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> from the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DELETE FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">SYSTEM_IDENTIFICATION_JOBS_TABLE</span><span class="si">}</span><span class="s2"> WHERE id = %s&quot;</span><span class="p">,</span>
                            <span class="p">(</span><span class="n">system_identification_job</span><span class="o">.</span><span class="n">id</span><span class="p">,))</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;System identification job with &quot;</span>
                                                     <span class="sa">f</span><span class="s2">&quot;id </span><span class="si">{</span><span class="n">system_identification_job</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> deleted successfully&quot;</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_convert_gaussian_mixture_system_model_record_to_dto</span><span class="p">(</span><span class="n">gaussian_mixture_system_model_record</span><span class="p">)</span> <span class="o">-&gt;</span> \
            <span class="n">GaussianMixtureSystemModel</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts a gaussian mixture system model record fetched from the metastore into a DTO</span>

<span class="sd">        :param gaussian_mixture_system_model_record: the record to convert</span>
<span class="sd">        :return: the DTO representing the record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">gaussian_mixture_system_model_config_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">gaussian_mixture_system_model_record</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                                                               <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
        <span class="n">gaussian_mixture_system_model_config</span><span class="p">:</span> <span class="n">GaussianMixtureSystemModel</span> <span class="o">=</span> \
            <span class="n">GaussianMixtureSystemModel</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">gaussian_mixture_system_model_config_json</span><span class="p">))</span>
        <span class="n">gaussian_mixture_system_model_config</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">gaussian_mixture_system_model_record</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">gaussian_mixture_system_model_config</span>

<div class="viewcode-block" id="MetastoreFacade.list_gaussian_mixture_system_models"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_gaussian_mixture_system_models">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_gaussian_mixture_system_models</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">GaussianMixtureSystemModel</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of gaussian mixture system models in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">GAUSSIAN_MIXTURE_SYSTEM_MODELS_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_gaussian_mixture_system_model_record_to_dto</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">records</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetastoreFacade.list_gaussian_mixture_system_models_ids"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_gaussian_mixture_system_models_ids">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_gaussian_mixture_system_models_ids</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of gaussian mixture system model ids in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT id,emulation_name,emulation_statistic_id FROM &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">GAUSSIAN_MIXTURE_SYSTEM_MODELS_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])),</span> <span class="n">records</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetastoreFacade.get_gaussian_mixture_system_model_config"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.get_gaussian_mixture_system_model_config">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_gaussian_mixture_system_model_config</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">GaussianMixtureSystemModel</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for fetching a gaussian mixture system model config with a given id from the metastore</span>

<span class="sd">        :param id: the id of the gaussian mixture system model config</span>
<span class="sd">        :return: The gaussian mixture system model config or None if it could not be found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">GAUSSIAN_MIXTURE_SYSTEM_MODELS_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;WHERE id = %s&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">record</span> <span class="o">=</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_gaussian_mixture_system_model_record_to_dto</span><span class="p">(</span>
                        <span class="n">gaussian_mixture_system_model_record</span><span class="o">=</span><span class="n">record</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">record</span></div>

<div class="viewcode-block" id="MetastoreFacade.save_gaussian_mixture_system_model"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.save_gaussian_mixture_system_model">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">save_gaussian_mixture_system_model</span><span class="p">(</span><span class="n">gaussian_mixture_system_model</span><span class="p">:</span> <span class="n">GaussianMixtureSystemModel</span><span class="p">)</span> \
            <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves a gaussian mixture system model to the metastore</span>

<span class="sd">        :param gaussian_mixture_system_model: the gaussian mixture system model to save</span>
<span class="sd">        :return: id of the created record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Saving a gaussian mixture system model in the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="c1"># Need to manually set the ID since CITUS does not handle serial columns</span>
                <span class="c1"># on distributed tables properly</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">GeneralUtil</span><span class="o">.</span><span class="n">get_latest_table_id</span><span class="p">(</span>
                    <span class="n">cur</span><span class="o">=</span><span class="n">cur</span><span class="p">,</span> <span class="n">table_name</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">GAUSSIAN_MIXTURE_SYSTEM_MODELS_TABLE</span><span class="p">)</span>
                <span class="n">gaussian_mixture_system_model_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">gaussian_mixture_system_model</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                                                                <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INSERT INTO </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">GAUSSIAN_MIXTURE_SYSTEM_MODELS_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;(id, model, emulation_name, emulation_statistic_id) &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;VALUES (%s, %s, %s, %s) RETURNING id&quot;</span><span class="p">,</span>
                            <span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">gaussian_mixture_system_model_json</span><span class="p">,</span>
                             <span class="n">gaussian_mixture_system_model</span><span class="o">.</span><span class="n">emulation_env_name</span><span class="p">,</span>
                             <span class="n">gaussian_mixture_system_model</span><span class="o">.</span><span class="n">emulation_statistic_id</span><span class="p">))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Gaussian mixture model saved successfully&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">id_of_new_row</span></div>

<div class="viewcode-block" id="MetastoreFacade.update_gaussian_mixture_system_model"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.update_gaussian_mixture_system_model">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">update_gaussian_mixture_system_model</span><span class="p">(</span><span class="n">gaussian_mixture_system_model</span><span class="p">:</span> <span class="n">GaussianMixtureSystemModel</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> \
            <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates a gaussian mixture system model in the metastore</span>

<span class="sd">        :param gaussian_mixture_system_model: the gaussian mixture system model to save</span>
<span class="sd">        :param id: the id of the row to update</span>
<span class="sd">        :return: id of the created record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updating gaussian mixture system model with id: </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2"> &quot;</span>
                                             <span class="sa">f</span><span class="s2">&quot;in the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">config_json_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">gaussian_mixture_system_model</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                             <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;UPDATE &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">GAUSSIAN_MIXTURE_SYSTEM_MODELS_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot; SET config=%s &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;WHERE </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">GAUSSIAN_MIXTURE_SYSTEM_MODELS_TABLE</span><span class="si">}</span><span class="s2">.id = %s&quot;</span><span class="p">,</span>
                            <span class="p">(</span><span class="n">config_json_str</span><span class="p">,</span> <span class="nb">id</span><span class="p">))</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Gaussian mixture system model with id: </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2"> &quot;</span>
                                                     <span class="sa">f</span><span class="s2">&quot;updated successfully&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetastoreFacade.remove_gaussian_mixture_system_model"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.remove_gaussian_mixture_system_model">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">remove_gaussian_mixture_system_model</span><span class="p">(</span><span class="n">gaussian_mixture_system_model</span><span class="p">:</span> <span class="n">GaussianMixtureSystemModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes a gaussian mixture system model from the metastore</span>

<span class="sd">        :param gaussian_mixture_system_model: the to remove</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing gaussian mixture system model with &quot;</span>
                                             <span class="sa">f</span><span class="s2">&quot;id:</span><span class="si">{</span><span class="n">gaussian_mixture_system_model</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> from the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DELETE FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">GAUSSIAN_MIXTURE_SYSTEM_MODELS_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;WHERE id = %s&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">gaussian_mixture_system_model</span><span class="o">.</span><span class="n">id</span><span class="p">,))</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Gaussian mixture system model with &quot;</span>
                                                     <span class="sa">f</span><span class="s2">&quot;id </span><span class="si">{</span><span class="n">gaussian_mixture_system_model</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> deleted successfully&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetastoreFacade.list_tabular_policies"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_tabular_policies">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_tabular_policies</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">TabularPolicy</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of Tabular policies in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">TABULAR_POLICIES_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_tabular_policy_record_to_dto</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">records</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetastoreFacade.list_tabular_policies_ids"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_tabular_policies_ids">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_tabular_policies_ids</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of Tabular policies ids in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT id,simulation_name FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">TABULAR_POLICIES_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span> <span class="n">records</span><span class="p">))</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_convert_tabular_policy_record_to_dto</span><span class="p">(</span><span class="n">tabular_policy_record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TabularPolicy</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts a Tabular policy record fetched from the metastore into a DTO</span>

<span class="sd">        :param tabular_policy_record: the record to convert</span>
<span class="sd">        :return: the DTO representing the record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tabular_policy_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">tabular_policy_record</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
        <span class="n">tabular_policy</span><span class="p">:</span> <span class="n">TabularPolicy</span> <span class="o">=</span> <span class="n">TabularPolicy</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">tabular_policy_json</span><span class="p">))</span>
        <span class="n">tabular_policy</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">tabular_policy_record</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">tabular_policy</span>

<div class="viewcode-block" id="MetastoreFacade.get_tabular_policy"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.get_tabular_policy">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_tabular_policy</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">TabularPolicy</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for fetching a Tabular policy with a given id from the metastore</span>

<span class="sd">        :param id: the id of the Tabular policy</span>
<span class="sd">        :return: The Tabular policy or None if it could not be found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">TABULAR_POLICIES_TABLE</span><span class="si">}</span><span class="s2"> WHERE id = %s&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">record</span> <span class="o">=</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_tabular_policy_record_to_dto</span><span class="p">(</span><span class="n">tabular_policy_record</span><span class="o">=</span><span class="n">record</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">record</span></div>

<div class="viewcode-block" id="MetastoreFacade.remove_tabular_policy"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.remove_tabular_policy">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">remove_tabular_policy</span><span class="p">(</span><span class="n">tabular_policy</span><span class="p">:</span> <span class="n">TabularPolicy</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes a Tabular policy from the metastore</span>

<span class="sd">        :param tabular_policy: the policy to remove</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing tabular policy with &quot;</span>
                                             <span class="sa">f</span><span class="s2">&quot;id:</span><span class="si">{</span><span class="n">tabular_policy</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> from the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DELETE FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">TABULAR_POLICIES_TABLE</span><span class="si">}</span><span class="s2"> WHERE id = %s&quot;</span><span class="p">,</span>
                            <span class="p">(</span><span class="n">tabular_policy</span><span class="o">.</span><span class="n">id</span><span class="p">,))</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tabular policy &quot;</span>
                                                     <span class="sa">f</span><span class="s2">&quot;with id </span><span class="si">{</span><span class="n">tabular_policy</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> deleted successfully&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetastoreFacade.save_tabular_policy"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.save_tabular_policy">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">save_tabular_policy</span><span class="p">(</span><span class="n">tabular_policy</span><span class="p">:</span> <span class="n">TabularPolicy</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves a Tabular policy to the metastore</span>

<span class="sd">        :param tabular_policy: the policy to save</span>
<span class="sd">        :return: id of the created record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Installing Tabular policy in the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="c1"># Need to manually set the ID since CITUS does not handle serial columns</span>
                <span class="c1"># on distributed tables properly</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">GeneralUtil</span><span class="o">.</span><span class="n">get_latest_table_id</span><span class="p">(</span>
                    <span class="n">cur</span><span class="o">=</span><span class="n">cur</span><span class="p">,</span> <span class="n">table_name</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">TABULAR_POLICIES_TABLE</span><span class="p">)</span>
                <span class="n">policy_json_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">tabular_policy</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INSERT INTO </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">TABULAR_POLICIES_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;(id, policy, simulation_name) &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;VALUES (%s, %s, %s) RETURNING id&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">policy_json_str</span><span class="p">,</span> <span class="n">tabular_policy</span><span class="o">.</span><span class="n">simulation_name</span><span class="p">))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Tabular policy saved successfully&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">id_of_new_row</span></div>

<div class="viewcode-block" id="MetastoreFacade.list_alpha_vec_policies"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_alpha_vec_policies">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_alpha_vec_policies</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">AlphaVectorsPolicy</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of AlphaVec policies in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">ALPHA_VEC_POLICIES_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_alpha_vec_policy_record_to_dto</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">records</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetastoreFacade.list_alpha_vec_policies_ids"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_alpha_vec_policies_ids">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_alpha_vec_policies_ids</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of AlphaVec policies ids in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT id,simulation_name FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">ALPHA_VEC_POLICIES_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span> <span class="n">records</span><span class="p">))</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_convert_alpha_vec_policy_record_to_dto</span><span class="p">(</span><span class="n">alpha_vec_policy_record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AlphaVectorsPolicy</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts a AlphaVec policy record fetched from the metastore into a DTO</span>

<span class="sd">        :param alpha_vec_policy_record: the record to convert</span>
<span class="sd">        :return: the DTO representing the record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">alpha_vec_policy_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">alpha_vec_policy_record</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
        <span class="n">alpha_vec_policy</span><span class="p">:</span> <span class="n">AlphaVectorsPolicy</span> <span class="o">=</span> <span class="n">AlphaVectorsPolicy</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">alpha_vec_policy_json</span><span class="p">))</span>
        <span class="n">alpha_vec_policy</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">alpha_vec_policy_record</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">alpha_vec_policy</span>

<div class="viewcode-block" id="MetastoreFacade.get_alpha_vec_policy"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.get_alpha_vec_policy">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_alpha_vec_policy</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">AlphaVectorsPolicy</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for fetching a AlphaVec policy with a given id from the metastore</span>

<span class="sd">        :param id: the id of the AlphaVec policy</span>
<span class="sd">        :return: The AlphaVec policy or None if it could not be found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">ALPHA_VEC_POLICIES_TABLE</span><span class="si">}</span><span class="s2"> WHERE id = %s&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">record</span> <span class="o">=</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_alpha_vec_policy_record_to_dto</span><span class="p">(</span><span class="n">alpha_vec_policy_record</span><span class="o">=</span><span class="n">record</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">record</span></div>

<div class="viewcode-block" id="MetastoreFacade.remove_alpha_vec_policy"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.remove_alpha_vec_policy">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">remove_alpha_vec_policy</span><span class="p">(</span><span class="n">alpha_vec_policy</span><span class="p">:</span> <span class="n">AlphaVectorsPolicy</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes a AlphaVec policy from the metastore</span>

<span class="sd">        :param alpha_vec_policy: the policy to remove</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing alpha_vec policy with &quot;</span>
                                             <span class="sa">f</span><span class="s2">&quot;id:</span><span class="si">{</span><span class="n">alpha_vec_policy</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> from the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DELETE FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">ALPHA_VEC_POLICIES_TABLE</span><span class="si">}</span><span class="s2"> WHERE id = %s&quot;</span><span class="p">,</span>
                            <span class="p">(</span><span class="n">alpha_vec_policy</span><span class="o">.</span><span class="n">id</span><span class="p">,))</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AlphaVec policy &quot;</span>
                                                     <span class="sa">f</span><span class="s2">&quot;with id </span><span class="si">{</span><span class="n">alpha_vec_policy</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> deleted successfully&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetastoreFacade.save_alpha_vec_policy"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.save_alpha_vec_policy">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">save_alpha_vec_policy</span><span class="p">(</span><span class="n">alpha_vec_policy</span><span class="p">:</span> <span class="n">AlphaVectorsPolicy</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves a AlphaVec policy to the metastore</span>

<span class="sd">        :param alpha_vec_policy: the policy to save</span>
<span class="sd">        :return: id of the created record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Installing AlphaVec policy in the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="c1"># Need to manually set the ID since CITUS does not handle serial columns</span>
                <span class="c1"># on distributed tables properly</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">GeneralUtil</span><span class="o">.</span><span class="n">get_latest_table_id</span><span class="p">(</span>
                    <span class="n">cur</span><span class="o">=</span><span class="n">cur</span><span class="p">,</span> <span class="n">table_name</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">ALPHA_VEC_POLICIES_TABLE</span><span class="p">)</span>
                <span class="n">policy_json_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">alpha_vec_policy</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INSERT INTO </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">ALPHA_VEC_POLICIES_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;(id, policy, simulation_name) &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;VALUES (%s, %s, %s) RETURNING id&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,</span>
                                                                  <span class="n">policy_json_str</span><span class="p">,</span> <span class="n">alpha_vec_policy</span><span class="o">.</span><span class="n">simulation_name</span><span class="p">))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;AlphaVec policy saved successfully&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">id_of_new_row</span></div>

<div class="viewcode-block" id="MetastoreFacade.list_dqn_policies"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_dqn_policies">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_dqn_policies</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">DQNPolicy</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of DQN policies in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DQN_POLICIES_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_dqn_policy_record_to_dto</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">records</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetastoreFacade.list_dqn_policies_ids"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_dqn_policies_ids">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_dqn_policies_ids</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of DQN policies ids in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT id,simulation_name FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DQN_POLICIES_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span> <span class="n">records</span><span class="p">))</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_convert_dqn_policy_record_to_dto</span><span class="p">(</span><span class="n">dqn_policy_record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DQNPolicy</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts a DQN policy record fetched from the metastore into a DTO</span>

<span class="sd">        :param dqn_policy_record: the record to convert</span>
<span class="sd">        :return: the DTO representing the record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dqn_policy_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">dqn_policy_record</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
        <span class="n">dqn_policy</span><span class="p">:</span> <span class="n">DQNPolicy</span> <span class="o">=</span> <span class="n">DQNPolicy</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">dqn_policy_json</span><span class="p">))</span>
        <span class="n">dqn_policy</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">dqn_policy_record</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">dqn_policy</span>

<div class="viewcode-block" id="MetastoreFacade.get_dqn_policy"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.get_dqn_policy">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_dqn_policy</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">DQNPolicy</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for fetching a DQN policy with a given id from the metastore</span>

<span class="sd">        :param id: the id of the DQN policy</span>
<span class="sd">        :return: The DQN policy or None if it could not be found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DQN_POLICIES_TABLE</span><span class="si">}</span><span class="s2"> WHERE id = %s&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">record</span> <span class="o">=</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_dqn_policy_record_to_dto</span><span class="p">(</span><span class="n">dqn_policy_record</span><span class="o">=</span><span class="n">record</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">record</span></div>

<div class="viewcode-block" id="MetastoreFacade.remove_dqn_policy"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.remove_dqn_policy">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">remove_dqn_policy</span><span class="p">(</span><span class="n">dqn_policy</span><span class="p">:</span> <span class="n">DQNPolicy</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes a DQN policy from the metastore</span>

<span class="sd">        :param dqn_policy: the policy to remove</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing dqn policy with &quot;</span>
                                             <span class="sa">f</span><span class="s2">&quot;id:</span><span class="si">{</span><span class="n">dqn_policy</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> from the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DELETE FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DQN_POLICIES_TABLE</span><span class="si">}</span><span class="s2"> WHERE id = %s&quot;</span><span class="p">,</span>
                            <span class="p">(</span><span class="n">dqn_policy</span><span class="o">.</span><span class="n">id</span><span class="p">,))</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DQN policy &quot;</span>
                                                     <span class="sa">f</span><span class="s2">&quot;with id </span><span class="si">{</span><span class="n">dqn_policy</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> deleted successfully&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetastoreFacade.save_dqn_policy"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.save_dqn_policy">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">save_dqn_policy</span><span class="p">(</span><span class="n">dqn_policy</span><span class="p">:</span> <span class="n">DQNPolicy</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves a DQN policy to the metastore</span>

<span class="sd">        :param dqn_policy: the policy to save</span>
<span class="sd">        :return: id of the created record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Installing DQN policy in the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="c1"># Need to manually set the ID since CITUS does not handle serial columns</span>
                <span class="c1"># on distributed tables properly</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">GeneralUtil</span><span class="o">.</span><span class="n">get_latest_table_id</span><span class="p">(</span>
                    <span class="n">cur</span><span class="o">=</span><span class="n">cur</span><span class="p">,</span> <span class="n">table_name</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DQN_POLICIES_TABLE</span><span class="p">)</span>
                <span class="n">policy_json_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">dqn_policy</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INSERT INTO </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DQN_POLICIES_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;(id, policy, simulation_name) &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;VALUES (%s, %s, %s) RETURNING id&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">policy_json_str</span><span class="p">,</span> <span class="n">dqn_policy</span><span class="o">.</span><span class="n">simulation_name</span><span class="p">))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;DQN policy saved successfully&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">id_of_new_row</span></div>

<div class="viewcode-block" id="MetastoreFacade.list_fnn_w_softmax_policies"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_fnn_w_softmax_policies">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_fnn_w_softmax_policies</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">FNNWithSoftmaxPolicy</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of FNN with softmax policies in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">FNN_W_SOFTMAX_POLICIES_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_fnn_w_softmax_policy_record_to_dto</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">records</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetastoreFacade.list_fnn_w_softmax_policies_ids"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_fnn_w_softmax_policies_ids">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_fnn_w_softmax_policies_ids</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of FNN with softmax policies ids in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT id,simulation_name FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">FNN_W_SOFTMAX_POLICIES_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span> <span class="n">records</span><span class="p">))</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_convert_fnn_w_softmax_policy_record_to_dto</span><span class="p">(</span><span class="n">fnn_w_softmax_policy_record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FNNWithSoftmaxPolicy</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts a FNN with softmax policy record fetched from the metastore into a DTO</span>

<span class="sd">        :param fnn_w_softmax_policy_record: the record to convert</span>
<span class="sd">        :return: the DTO representing the record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fnn_w_softmax_policy_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">fnn_w_softmax_policy_record</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
        <span class="n">fnn_w_softmax_policy</span><span class="p">:</span> <span class="n">FNNWithSoftmaxPolicy</span> <span class="o">=</span> <span class="n">FNNWithSoftmaxPolicy</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span>
            <span class="n">fnn_w_softmax_policy_json</span><span class="p">))</span>
        <span class="n">fnn_w_softmax_policy</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">fnn_w_softmax_policy_record</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">fnn_w_softmax_policy</span>

<div class="viewcode-block" id="MetastoreFacade.get_fnn_w_softmax_policy"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.get_fnn_w_softmax_policy">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_fnn_w_softmax_policy</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">FNNWithSoftmaxPolicy</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for fetching a FNN with softmax policy with a given id from the metastore</span>

<span class="sd">        :param id: the id of the FNN with softmax policy</span>
<span class="sd">        :return: The FNN with softmax policy or None if it could not be found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">FNN_W_SOFTMAX_POLICIES_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;WHERE id = %s&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">record</span> <span class="o">=</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_fnn_w_softmax_policy_record_to_dto</span><span class="p">(</span>
                        <span class="n">fnn_w_softmax_policy_record</span><span class="o">=</span><span class="n">record</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">record</span></div>

<div class="viewcode-block" id="MetastoreFacade.remove_fnn_w_softmax_policy"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.remove_fnn_w_softmax_policy">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">remove_fnn_w_softmax_policy</span><span class="p">(</span><span class="n">fnn_w_softmax_policy</span><span class="p">:</span> <span class="n">FNNWithSoftmaxPolicy</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes a FNN with softmax policy from the metastore</span>

<span class="sd">        :param fnn_w_softmax_policy: the policy to remove</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing fnn_w_softmax policy with &quot;</span>
                                             <span class="sa">f</span><span class="s2">&quot;id:</span><span class="si">{</span><span class="n">fnn_w_softmax_policy</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> from the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DELETE FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">FNN_W_SOFTMAX_POLICIES_TABLE</span><span class="si">}</span><span class="s2"> WHERE id = %s&quot;</span><span class="p">,</span>
                            <span class="p">(</span><span class="n">fnn_w_softmax_policy</span><span class="o">.</span><span class="n">id</span><span class="p">,))</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;FNN with softmax policy &quot;</span>
                                                     <span class="sa">f</span><span class="s2">&quot;with id </span><span class="si">{</span><span class="n">fnn_w_softmax_policy</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> deleted successfully&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetastoreFacade.save_fnn_w_softmax_policy"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.save_fnn_w_softmax_policy">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">save_fnn_w_softmax_policy</span><span class="p">(</span><span class="n">fnn_w_softmax_policy</span><span class="p">:</span> <span class="n">FNNWithSoftmaxPolicy</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves a FNN with softmax policy to the metastore</span>

<span class="sd">        :param fnn_w_softmax_policy: the policy to save</span>
<span class="sd">        :return: id of the created record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Installing FNN with softmax policy in the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="c1"># Need to manually set the ID since CITUS does not handle serial columns</span>
                <span class="c1"># on distributed tables properly</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">GeneralUtil</span><span class="o">.</span><span class="n">get_latest_table_id</span><span class="p">(</span>
                    <span class="n">cur</span><span class="o">=</span><span class="n">cur</span><span class="p">,</span> <span class="n">table_name</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">FNN_W_SOFTMAX_POLICIES_TABLE</span><span class="p">)</span>
                <span class="n">policy_json_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">fnn_w_softmax_policy</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INSERT INTO </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">FNN_W_SOFTMAX_POLICIES_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;(id, policy, simulation_name) &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;VALUES (%s, %s, %s) RETURNING id&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,</span>
                                                                  <span class="n">policy_json_str</span><span class="p">,</span>
                                                                  <span class="n">fnn_w_softmax_policy</span><span class="o">.</span><span class="n">simulation_name</span><span class="p">))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;FNN with softmax policy saved successfully&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">id_of_new_row</span></div>

<div class="viewcode-block" id="MetastoreFacade.list_vector_policies"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_vector_policies">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_vector_policies</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">VectorPolicy</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of vector policies in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">VECTOR_POLICIES_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_vector_policy_record_to_dto</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">records</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetastoreFacade.list_vector_policies_ids"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_vector_policies_ids">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_vector_policies_ids</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of vector policies ids in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT id,simulation_name FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">VECTOR_POLICIES_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span> <span class="n">records</span><span class="p">))</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_convert_vector_policy_record_to_dto</span><span class="p">(</span><span class="n">vector_policy_record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VectorPolicy</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts a vector policy record fetched from the metastore into a DTO</span>

<span class="sd">        :param vector_policy_record: the record to convert</span>
<span class="sd">        :return: the DTO representing the record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">vector_policy_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">vector_policy_record</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
        <span class="n">vector_policy</span><span class="p">:</span> <span class="n">VectorPolicy</span> <span class="o">=</span> <span class="n">VectorPolicy</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">vector_policy_json</span><span class="p">))</span>
        <span class="n">vector_policy</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">vector_policy_record</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">vector_policy</span>

<div class="viewcode-block" id="MetastoreFacade.get_vector_policy"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.get_vector_policy">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_vector_policy</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">VectorPolicy</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for fetching a vector policy with a given id from the metastore</span>

<span class="sd">        :param id: the id of the vector policy</span>
<span class="sd">        :return: The vector policy or None if it could not be found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">VECTOR_POLICIES_TABLE</span><span class="si">}</span><span class="s2"> WHERE id = %s&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">record</span> <span class="o">=</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_vector_policy_record_to_dto</span><span class="p">(</span><span class="n">vector_policy_record</span><span class="o">=</span><span class="n">record</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">record</span></div>

<div class="viewcode-block" id="MetastoreFacade.remove_vector_policy"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.remove_vector_policy">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">remove_vector_policy</span><span class="p">(</span><span class="n">vector_policy</span><span class="p">:</span> <span class="n">VectorPolicy</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes a vector policy from the metastore</span>

<span class="sd">        :param vector_policy: the policy to remove</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing vector policy with &quot;</span>
                                             <span class="sa">f</span><span class="s2">&quot;id:</span><span class="si">{</span><span class="n">vector_policy</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> from the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DELETE FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">VECTOR_POLICIES_TABLE</span><span class="si">}</span><span class="s2"> WHERE id = %s&quot;</span><span class="p">,</span>
                            <span class="p">(</span><span class="n">vector_policy</span><span class="o">.</span><span class="n">id</span><span class="p">,))</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;vector policy &quot;</span>
                                                     <span class="sa">f</span><span class="s2">&quot;with id </span><span class="si">{</span><span class="n">vector_policy</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> deleted successfully&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetastoreFacade.save_vector_policy"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.save_vector_policy">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">save_vector_policy</span><span class="p">(</span><span class="n">vector_policy</span><span class="p">:</span> <span class="n">VectorPolicy</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves a vector policy to the metastore</span>

<span class="sd">        :param vector_policy: the policy to save</span>
<span class="sd">        :return: id of the created record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Installing vector policy in the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="c1"># Need to manually set the ID since CITUS does not handle serial columns</span>
                <span class="c1"># on distributed tables properly</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">GeneralUtil</span><span class="o">.</span><span class="n">get_latest_table_id</span><span class="p">(</span>
                    <span class="n">cur</span><span class="o">=</span><span class="n">cur</span><span class="p">,</span> <span class="n">table_name</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">VECTOR_POLICIES_TABLE</span><span class="p">)</span>
                <span class="n">policy_json_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">vector_policy</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INSERT INTO </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">VECTOR_POLICIES_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;(id, policy, simulation_name) &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;VALUES (%s, %s, %s) RETURNING id&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">policy_json_str</span><span class="p">,</span> <span class="n">vector_policy</span><span class="o">.</span><span class="n">simulation_name</span><span class="p">))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;vector policy saved successfully&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">id_of_new_row</span></div>

<div class="viewcode-block" id="MetastoreFacade.list_emulation_execution_ids"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_emulation_execution_ids">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_emulation_execution_ids</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of emulation executions in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT ip_first_octet,emulation_name FROM &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EMULATION_EXECUTIONS_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span> <span class="n">records</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetastoreFacade.list_emulation_executions"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_emulation_executions">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_emulation_executions</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">EmulationExecution</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of emulation executions in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EMULATION_EXECUTIONS_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_emulation_execution_record_to_dto</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">records</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetastoreFacade.list_emulation_executions_for_a_given_emulation"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_emulation_executions_for_a_given_emulation">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_emulation_executions_for_a_given_emulation</span><span class="p">(</span><span class="n">emulation_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">EmulationExecution</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param emulation_name: the name of the emulation</span>
<span class="sd">        :return: A list of emulation executions in the metastore for a given emulation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EMULATION_EXECUTIONS_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;WHERE emulation_name = %s&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">emulation_name</span><span class="p">,))</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_emulation_execution_record_to_dto</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">records</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetastoreFacade.list_emulation_executions_by_id"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_emulation_executions_by_id">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_emulation_executions_by_id</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">EmulationExecution</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param id: the first IP octet of the execution</span>
<span class="sd">        :return: A list of emulation executions in the metastore for a given emulation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EMULATION_EXECUTIONS_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;WHERE ip_first_octet = %s&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,))</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_emulation_execution_record_to_dto</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">records</span><span class="p">))</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_convert_emulation_execution_record_to_dto</span><span class="p">(</span><span class="n">emulation_execution_record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EmulationExecution</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts a emulation execution record fetched from the metastore into a DTO</span>

<span class="sd">        :param emulation_execution_record: the record to convert</span>
<span class="sd">        :return: the DTO representing the record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">emulation_execution_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">emulation_execution_record</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
        <span class="n">emulation_execution</span><span class="p">:</span> <span class="n">EmulationExecution</span> <span class="o">=</span> <span class="n">EmulationExecution</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">emulation_execution_json</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">emulation_execution</span>

<div class="viewcode-block" id="MetastoreFacade.get_emulation_execution"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.get_emulation_execution">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_emulation_execution</span><span class="p">(</span><span class="n">ip_first_octet</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">emulation_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">EmulationExecution</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for fetching a emulation execution with a given id from the metastore</span>

<span class="sd">        :param ip_first_octet: the id of the emulation execution</span>
<span class="sd">        :param emulation_name: the name of the emulation</span>
<span class="sd">        :return: The emulation execution or None if it could not be found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EMULATION_EXECUTIONS_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;WHERE ip_first_octet = %s AND emulation_name=%s&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">ip_first_octet</span><span class="p">,</span> <span class="n">emulation_name</span><span class="p">))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">record</span> <span class="o">=</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_emulation_execution_record_to_dto</span><span class="p">(</span>
                        <span class="n">emulation_execution_record</span><span class="o">=</span><span class="n">record</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">record</span></div>

<div class="viewcode-block" id="MetastoreFacade.remove_emulation_execution"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.remove_emulation_execution">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">remove_emulation_execution</span><span class="p">(</span><span class="n">emulation_execution</span><span class="p">:</span> <span class="n">EmulationExecution</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes a emulation execution from the metastore</span>

<span class="sd">        :param emulation_execution: the policy to remove</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing emulation execution with &quot;</span>
                                             <span class="sa">f</span><span class="s2">&quot;ip_first_octet:</span><span class="si">{</span><span class="n">emulation_execution</span><span class="o">.</span><span class="n">ip_first_octet</span><span class="si">}</span><span class="s2"> from the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DELETE FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EMULATION_EXECUTIONS_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;WHERE ip_first_octet = %s AND emulation_name = %s&quot;</span><span class="p">,</span>
                            <span class="p">(</span><span class="n">emulation_execution</span><span class="o">.</span><span class="n">ip_first_octet</span><span class="p">,</span> <span class="n">emulation_execution</span><span class="o">.</span><span class="n">emulation_name</span><span class="p">))</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;emulation execution &quot;</span>
                                                     <span class="sa">f</span><span class="s2">&quot;with ip_first_octet </span><span class="si">{</span><span class="n">emulation_execution</span><span class="o">.</span><span class="n">ip_first_octet</span><span class="si">}</span><span class="s2"> &quot;</span>
                                                     <span class="sa">f</span><span class="s2">&quot;deleted successfully&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetastoreFacade.save_emulation_execution"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.save_emulation_execution">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">save_emulation_execution</span><span class="p">(</span><span class="n">emulation_execution</span><span class="p">:</span> <span class="n">EmulationExecution</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves a emulation execution to the metastore</span>

<span class="sd">        :param emulation_execution: the policy to save</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Installing emulation execution in the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">emulation_execution_str</span> <span class="o">=</span> \
                    <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">emulation_execution</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INSERT INTO </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EMULATION_EXECUTIONS_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;(ip_first_octet, emulation_name, info) &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;VALUES (%s, %s, %s) RETURNING ip_first_octet&quot;</span><span class="p">,</span>
                            <span class="p">(</span>
                                <span class="n">emulation_execution</span><span class="o">.</span><span class="n">ip_first_octet</span><span class="p">,</span>
                                <span class="n">emulation_execution</span><span class="o">.</span><span class="n">emulation_name</span><span class="p">,</span>
                                <span class="n">emulation_execution_str</span><span class="p">))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;emulation execution saved successfully&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">id_of_new_row</span></div>

<div class="viewcode-block" id="MetastoreFacade.update_emulation_execution"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.update_emulation_execution">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">update_emulation_execution</span><span class="p">(</span><span class="n">emulation_execution</span><span class="p">:</span> <span class="n">EmulationExecution</span><span class="p">,</span> <span class="n">ip_first_octet</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                                   <span class="n">emulation</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates an emulation execution in the metastore</span>

<span class="sd">        :param emulation_execution: the emulation execution to update</span>
<span class="sd">        :param ip_first_octet: the first octet of the ip of the execution</span>
<span class="sd">        :param emulation: the emulation of the execution</span>
<span class="sd">        :return: id of the created record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updating emulation execution with ip first octet: </span><span class="si">{</span><span class="n">ip_first_octet</span><span class="si">}</span><span class="s2"> &quot;</span>
                                             <span class="sa">f</span><span class="s2">&quot;and emulation: </span><span class="si">{</span><span class="n">emulation</span><span class="si">}</span><span class="s2"> &quot;</span>
                                             <span class="sa">f</span><span class="s2">&quot;in the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">config_json_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">emulation_execution</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;UPDATE &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EMULATION_EXECUTIONS_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot; SET info=%s &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;WHERE </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EMULATION_EXECUTIONS_TABLE</span><span class="si">}</span><span class="s2">.ip_first_octet = %s &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;AND </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EMULATION_EXECUTIONS_TABLE</span><span class="si">}</span><span class="s2">.emulation_name = %s&quot;</span><span class="p">,</span>
                            <span class="p">(</span><span class="n">config_json_str</span><span class="p">,</span> <span class="n">ip_first_octet</span><span class="p">,</span> <span class="n">emulation</span><span class="p">))</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Emulation execution with ip first octet: </span><span class="si">{</span><span class="n">ip_first_octet</span><span class="si">}</span><span class="s2"> &quot;</span>
                                                     <span class="sa">f</span><span class="s2">&quot;and emulation: </span><span class="si">{</span><span class="n">emulation</span><span class="si">}</span><span class="s2"> &quot;</span>
                                                     <span class="sa">f</span><span class="s2">&quot;updated successfully&quot;</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_convert_empirical_system_model_record_to_dto</span><span class="p">(</span><span class="n">empirical_system_model_record</span><span class="p">)</span> <span class="o">-&gt;</span> \
            <span class="n">EmpiricalSystemModel</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts a empirical system model record fetched from the metastore into a DTO</span>

<span class="sd">        :param empirical_system_model_record: the record to convert</span>
<span class="sd">        :return: the DTO representing the record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">empirical_system_model_config_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">empirical_system_model_record</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                        <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
        <span class="n">empirical_system_model_config</span><span class="p">:</span> <span class="n">EmpiricalSystemModel</span> <span class="o">=</span> \
            <span class="n">EmpiricalSystemModel</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">empirical_system_model_config_json</span><span class="p">))</span>
        <span class="n">empirical_system_model_config</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">empirical_system_model_record</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">empirical_system_model_config</span>

<div class="viewcode-block" id="MetastoreFacade.list_empirical_system_models"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_empirical_system_models">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_empirical_system_models</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">EmpiricalSystemModel</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of empirical system models in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EMPIRICAL_SYSTEM_MODELS_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_empirical_system_model_record_to_dto</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">records</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetastoreFacade.list_empirical_system_models_ids"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_empirical_system_models_ids">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_empirical_system_models_ids</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of empirical system model ids in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT id,emulation_name,emulation_statistic_id FROM &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EMPIRICAL_SYSTEM_MODELS_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])),</span> <span class="n">records</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetastoreFacade.get_empirical_system_model_config"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.get_empirical_system_model_config">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_empirical_system_model_config</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">EmpiricalSystemModel</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for fetching an empirical system model config with a given id from the metastore</span>

<span class="sd">        :param id: the id of the empirical system model config</span>
<span class="sd">        :return: The empirical system model config or None if it could not be found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EMPIRICAL_SYSTEM_MODELS_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;WHERE id = %s&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">record</span> <span class="o">=</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_empirical_system_model_record_to_dto</span><span class="p">(</span>
                        <span class="n">empirical_system_model_record</span><span class="o">=</span><span class="n">record</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">record</span></div>

<div class="viewcode-block" id="MetastoreFacade.save_empirical_system_model"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.save_empirical_system_model">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">save_empirical_system_model</span><span class="p">(</span><span class="n">empirical_system_model</span><span class="p">:</span> <span class="n">EmpiricalSystemModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves a empirical system model to the metastore</span>

<span class="sd">        :param empirical_system_model: the empirical system model to save</span>
<span class="sd">        :return: id of the created record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Saving a empirical system model in the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="c1"># Need to manually set the ID since CITUS does not handle serial columns</span>
                <span class="c1"># on distributed tables properly</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">GeneralUtil</span><span class="o">.</span><span class="n">get_latest_table_id</span><span class="p">(</span>
                    <span class="n">cur</span><span class="o">=</span><span class="n">cur</span><span class="p">,</span> <span class="n">table_name</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EMPIRICAL_SYSTEM_MODELS_TABLE</span><span class="p">)</span>
                <span class="n">empirical_system_model_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">empirical_system_model</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                         <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INSERT INTO </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EMPIRICAL_SYSTEM_MODELS_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;(id, model, emulation_name, emulation_statistic_id) &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;VALUES (%s, %s, %s, %s) RETURNING id&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">empirical_system_model_json</span><span class="p">,</span>
                                                                      <span class="n">empirical_system_model</span><span class="o">.</span><span class="n">emulation_env_name</span><span class="p">,</span>
                                                                      <span class="n">empirical_system_model</span><span class="o">.</span><span class="n">emulation_statistic_id</span><span class="p">))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;empirical system model saved successfully&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">id_of_new_row</span></div>

<div class="viewcode-block" id="MetastoreFacade.update_empirical_system_model"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.update_empirical_system_model">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">update_empirical_system_model</span><span class="p">(</span><span class="n">empirical_system_model</span><span class="p">:</span> <span class="n">EmpiricalSystemModel</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates a empirical system model in the metastore</span>

<span class="sd">        :param empirical_system_model: the empirical system model to save</span>
<span class="sd">        :param id: the id of the row to update</span>
<span class="sd">        :return: id of the created record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updating empirical system model with id: </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2"> in the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">config_json_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">empirical_system_model</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;UPDATE &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EMPIRICAL_SYSTEM_MODELS_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot; SET config=%s &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;WHERE </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EMPIRICAL_SYSTEM_MODELS_TABLE</span><span class="si">}</span><span class="s2">.id = %s&quot;</span><span class="p">,</span>
                            <span class="p">(</span><span class="n">config_json_str</span><span class="p">,</span> <span class="nb">id</span><span class="p">))</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Empirical system model with id: </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2"> updated successfully&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetastoreFacade.remove_empirical_system_model"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.remove_empirical_system_model">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">remove_empirical_system_model</span><span class="p">(</span><span class="n">empirical_system_model</span><span class="p">:</span> <span class="n">EmpiricalSystemModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes a empirical system model from the metastore</span>

<span class="sd">        :param empirical_system_model: the to remove</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing empirical system model with &quot;</span>
                                             <span class="sa">f</span><span class="s2">&quot;id:</span><span class="si">{</span><span class="n">empirical_system_model</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> from the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DELETE FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">EMPIRICAL_SYSTEM_MODELS_TABLE</span><span class="si">}</span><span class="s2"> WHERE id = %s&quot;</span><span class="p">,</span>
                            <span class="p">(</span><span class="n">empirical_system_model</span><span class="o">.</span><span class="n">id</span><span class="p">,))</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Empirical system model with &quot;</span>
                                                     <span class="sa">f</span><span class="s2">&quot;id </span><span class="si">{</span><span class="n">empirical_system_model</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> deleted successfully&quot;</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_convert_mcmc_system_model_record_to_dto</span><span class="p">(</span><span class="n">mcmc_system_model_record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MCMCSystemModel</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts a MCMC system model record fetched from the metastore into a DTO</span>

<span class="sd">        :param mcmc_system_model_record: the record to convert</span>
<span class="sd">        :return: the DTO representing the record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mcmc_system_model_config_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">mcmc_system_model_record</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
        <span class="n">mcmc_system_model_config</span><span class="p">:</span> <span class="n">MCMCSystemModel</span> <span class="o">=</span> <span class="n">MCMCSystemModel</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">mcmc_system_model_config_json</span><span class="p">))</span>
        <span class="n">mcmc_system_model_config</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">mcmc_system_model_record</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">mcmc_system_model_config</span>

<div class="viewcode-block" id="MetastoreFacade.list_mcmc_system_models"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_mcmc_system_models">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_mcmc_system_models</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">MCMCSystemModel</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of MCMC system models in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">MCMC_SYSTEM_MODELS_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_mcmc_system_model_record_to_dto</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">records</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetastoreFacade.list_mcmc_system_models_ids"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_mcmc_system_models_ids">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_mcmc_system_models_ids</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of MCMC system model ids in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT id,emulation_name,emulation_statistic_id FROM &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">MCMC_SYSTEM_MODELS_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])),</span> <span class="n">records</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetastoreFacade.get_mcmc_system_model_config"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.get_mcmc_system_model_config">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_mcmc_system_model_config</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">MCMCSystemModel</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for fetching a mcmc system model config with a given id from the metastore</span>

<span class="sd">        :param id: the id of the mcmc system model config</span>
<span class="sd">        :return: The mcmc system model config or None if it could not be found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">MCMC_SYSTEM_MODELS_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;WHERE id = %s&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">record</span> <span class="o">=</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_mcmc_system_model_record_to_dto</span><span class="p">(</span><span class="n">mcmc_system_model_record</span><span class="o">=</span><span class="n">record</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">record</span></div>

<div class="viewcode-block" id="MetastoreFacade.save_mcmc_system_model"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.save_mcmc_system_model">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">save_mcmc_system_model</span><span class="p">(</span><span class="n">mcmc_system_model</span><span class="p">:</span> <span class="n">MCMCSystemModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves a mcmc system model to the metastore</span>

<span class="sd">        :param mcmc_system_model: the mcmc system model to save</span>
<span class="sd">        :return: id of the created record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Saving a mcmc system model in the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="c1"># Need to manually set the ID since CITUS does not handle serial columns</span>
                <span class="c1"># on distributed tables properly</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">GeneralUtil</span><span class="o">.</span><span class="n">get_latest_table_id</span><span class="p">(</span>
                    <span class="n">cur</span><span class="o">=</span><span class="n">cur</span><span class="p">,</span> <span class="n">table_name</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">MCMC_SYSTEM_MODELS_TABLE</span><span class="p">)</span>
                <span class="n">mcmc_system_model_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">mcmc_system_model</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
                                                    <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INSERT INTO </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">MCMC_SYSTEM_MODELS_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;(id, model, emulation_name, emulation_statistic_id) &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;VALUES (%s, %s, %s, %s) RETURNING id&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">mcmc_system_model_json</span><span class="p">,</span>
                                                                      <span class="n">mcmc_system_model</span><span class="o">.</span><span class="n">emulation_env_name</span><span class="p">,</span>
                                                                      <span class="n">mcmc_system_model</span><span class="o">.</span><span class="n">emulation_statistic_id</span><span class="p">))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;mcmc system model saved successfully&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">id_of_new_row</span></div>

<div class="viewcode-block" id="MetastoreFacade.update_mcmc_system_model"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.update_mcmc_system_model">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">update_mcmc_system_model</span><span class="p">(</span><span class="n">mcmc_system_model</span><span class="p">:</span> <span class="n">MCMCSystemModel</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates a mcmc system model in the metastore</span>

<span class="sd">        :param mcmc_system_model: the mcmc system model to save</span>
<span class="sd">        :param id: the id of the row to update</span>
<span class="sd">        :return: id of the created record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updating mcmc system model with id: </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2"> in the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">config_json_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">mcmc_system_model</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;UPDATE &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">MCMC_SYSTEM_MODELS_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot; SET config=%s &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;WHERE </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">MCMC_SYSTEM_MODELS_TABLE</span><span class="si">}</span><span class="s2">.id = %s&quot;</span><span class="p">,</span>
                            <span class="p">(</span><span class="n">config_json_str</span><span class="p">,</span> <span class="nb">id</span><span class="p">))</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MCMC system model with id: </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2"> updated successfully&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetastoreFacade.remove_mcmc_system_model"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.remove_mcmc_system_model">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">remove_mcmc_system_model</span><span class="p">(</span><span class="n">mcmc_system_model</span><span class="p">:</span> <span class="n">MCMCSystemModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes a MCMC system model from the metastore</span>

<span class="sd">        :param mcmc_system_model: the system model to remove</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing MCMC system model with &quot;</span>
                                             <span class="sa">f</span><span class="s2">&quot;id:</span><span class="si">{</span><span class="n">mcmc_system_model</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> from the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DELETE FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">MCMC_SYSTEM_MODELS_TABLE</span><span class="si">}</span><span class="s2"> WHERE id = %s&quot;</span><span class="p">,</span>
                            <span class="p">(</span><span class="n">mcmc_system_model</span><span class="o">.</span><span class="n">id</span><span class="p">,))</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MCMC system model with &quot;</span>
                                                     <span class="sa">f</span><span class="s2">&quot;id </span><span class="si">{</span><span class="n">mcmc_system_model</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> deleted successfully&quot;</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_convert_gp_system_model_record_to_dto</span><span class="p">(</span><span class="n">gp_system_model_record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GPSystemModel</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts a gp system model record fetched from the metastore into a DTO</span>

<span class="sd">        :param gp_system_model_record: the record to convert</span>
<span class="sd">        :return: the DTO representing the record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">gp_system_model_config_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">gp_system_model_record</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
        <span class="n">gp_system_model_config</span><span class="p">:</span> <span class="n">GPSystemModel</span> <span class="o">=</span> \
            <span class="n">GPSystemModel</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">gp_system_model_config_json</span><span class="p">))</span>
        <span class="n">gp_system_model_config</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">gp_system_model_record</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">gp_system_model_config</span>

<div class="viewcode-block" id="MetastoreFacade.list_gp_system_models"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_gp_system_models">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_gp_system_models</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">GPSystemModel</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of gp system models in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">GP_SYSTEM_MODELS_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_gp_system_model_record_to_dto</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">records</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetastoreFacade.list_gp_system_models_ids"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_gp_system_models_ids">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_gp_system_models_ids</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of gp system model ids in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT id,emulation_name,emulation_statistic_id FROM &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">GP_SYSTEM_MODELS_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])),</span> <span class="n">records</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetastoreFacade.get_gp_system_model_config"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.get_gp_system_model_config">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_gp_system_model_config</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">GPSystemModel</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for fetching a gp system model config with a given id from the metastore</span>

<span class="sd">        :param id: the id of the gp system model config</span>
<span class="sd">        :return: The gp system model config or None if it could not be found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">GP_SYSTEM_MODELS_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;WHERE id = %s&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">record</span> <span class="o">=</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_gp_system_model_record_to_dto</span><span class="p">(</span>
                        <span class="n">gp_system_model_record</span><span class="o">=</span><span class="n">record</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">record</span></div>

<div class="viewcode-block" id="MetastoreFacade.save_gp_system_model"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.save_gp_system_model">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">save_gp_system_model</span><span class="p">(</span><span class="n">gp_system_model</span><span class="p">:</span> <span class="n">GPSystemModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves a gp system model to the metastore</span>

<span class="sd">        :param gp_system_model: the gp system model to save</span>
<span class="sd">        :return: id of the created record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Saving a gp system model in the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="c1"># Need to manually set the ID since CITUS does not handle serial columns</span>
                <span class="c1"># on distributed tables properly</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">GeneralUtil</span><span class="o">.</span><span class="n">get_latest_table_id</span><span class="p">(</span>
                    <span class="n">cur</span><span class="o">=</span><span class="n">cur</span><span class="p">,</span> <span class="n">table_name</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">GP_SYSTEM_MODELS_TABLE</span><span class="p">)</span>
                <span class="n">gp_system_model_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">gp_system_model</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INSERT INTO </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">GP_SYSTEM_MODELS_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;(id, model, emulation_name, emulation_statistic_id) &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;VALUES (%s, %s, %s, %s) RETURNING id&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">gp_system_model_json</span><span class="p">,</span>
                                                                      <span class="n">gp_system_model</span><span class="o">.</span><span class="n">emulation_env_name</span><span class="p">,</span>
                                                                      <span class="n">gp_system_model</span><span class="o">.</span><span class="n">emulation_statistic_id</span><span class="p">))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;gp system model saved successfully&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">id_of_new_row</span></div>

<div class="viewcode-block" id="MetastoreFacade.update_gp_system_model"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.update_gp_system_model">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">update_gp_system_model</span><span class="p">(</span><span class="n">gp_system_model</span><span class="p">:</span> <span class="n">GPSystemModel</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates a gp system model in the metastore</span>

<span class="sd">        :param gp_system_model: the gp system model to save</span>
<span class="sd">        :param id: the id of the row to update</span>
<span class="sd">        :return: id of the created record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updating gp system model with id: </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2"> in the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">config_json_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">gp_system_model</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;UPDATE &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">GP_SYSTEM_MODELS_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot; SET config=%s &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;WHERE </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">GP_SYSTEM_MODELS_TABLE</span><span class="si">}</span><span class="s2">.id = %s&quot;</span><span class="p">,</span>
                            <span class="p">(</span><span class="n">config_json_str</span><span class="p">,</span> <span class="nb">id</span><span class="p">))</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;GP system model with id: </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2"> updated successfully&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetastoreFacade.remove_gp_system_model"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.remove_gp_system_model">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">remove_gp_system_model</span><span class="p">(</span><span class="n">gp_system_model</span><span class="p">:</span> <span class="n">GPSystemModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes a gp system model from the metastore</span>

<span class="sd">        :param gp_system_model: the model to remove</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing gp system model with &quot;</span>
                                             <span class="sa">f</span><span class="s2">&quot;id:</span><span class="si">{</span><span class="n">gp_system_model</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> from the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DELETE FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">GP_SYSTEM_MODELS_TABLE</span><span class="si">}</span><span class="s2"> WHERE id = %s&quot;</span><span class="p">,</span>
                            <span class="p">(</span><span class="n">gp_system_model</span><span class="o">.</span><span class="n">id</span><span class="p">,))</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;GP system model with &quot;</span>
                                                     <span class="sa">f</span><span class="s2">&quot;id </span><span class="si">{</span><span class="n">gp_system_model</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> deleted successfully&quot;</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_convert_management_user_record_to_dto</span><span class="p">(</span><span class="n">management_user_record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ManagementUser</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts a management user record fetched from the metastore into a DTO</span>

<span class="sd">        :param management_user_record: the record to convert</span>
<span class="sd">        :return: the DTO representing the record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">management_user</span> <span class="o">=</span> <span class="n">ManagementUser</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">management_user_record</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">password</span><span class="o">=</span><span class="n">management_user_record</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                                         <span class="n">email</span><span class="o">=</span><span class="n">management_user_record</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">first_name</span><span class="o">=</span><span class="n">management_user_record</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
                                         <span class="n">last_name</span><span class="o">=</span><span class="n">management_user_record</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">organization</span><span class="o">=</span><span class="n">management_user_record</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>
                                         <span class="n">admin</span><span class="o">=</span><span class="n">management_user_record</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">salt</span><span class="o">=</span><span class="n">management_user_record</span><span class="p">[</span><span class="mi">8</span><span class="p">])</span>
        <span class="n">management_user</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">management_user_record</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">management_user</span>

<div class="viewcode-block" id="MetastoreFacade.list_management_users"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_management_users">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_management_users</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ManagementUser</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of management users in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">MANAGEMENT_USERS_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_management_user_record_to_dto</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">records</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetastoreFacade.list_management_users_ids"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_management_users_ids">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_management_users_ids</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of management user ids in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT id FROM &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">MANAGEMENT_USERS_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">records</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetastoreFacade.get_management_user_config"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.get_management_user_config">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_management_user_config</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">ManagementUser</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for fetching a management user with a given id from the metastore</span>

<span class="sd">        :param id: the id of the management user</span>
<span class="sd">        :return: The management user or None if it could not be found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">MANAGEMENT_USERS_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;WHERE id = %s&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">record</span> <span class="o">=</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_management_user_record_to_dto</span><span class="p">(</span>
                        <span class="n">management_user_record</span><span class="o">=</span><span class="n">record</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">record</span></div>

<div class="viewcode-block" id="MetastoreFacade.save_management_user"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.save_management_user">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">save_management_user</span><span class="p">(</span><span class="n">management_user</span><span class="p">:</span> <span class="n">ManagementUser</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves a management user to the metastore</span>

<span class="sd">        :param management_user: the management user to save</span>
<span class="sd">        :return: id of the created record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Saving a management user in the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="c1"># Need to manually set the ID since CITUS does not handle serial columns</span>
                <span class="c1"># on distributed tables properly</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">GeneralUtil</span><span class="o">.</span><span class="n">get_latest_table_id</span><span class="p">(</span>
                    <span class="n">cur</span><span class="o">=</span><span class="n">cur</span><span class="p">,</span> <span class="n">table_name</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">MANAGEMENT_USERS_TABLE</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INSERT INTO </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">MANAGEMENT_USERS_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;(id, username, password, email, first_name, last_name, organization, admin, salt) &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s) RETURNING id&quot;</span><span class="p">,</span>
                            <span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">management_user</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">management_user</span><span class="o">.</span><span class="n">password</span><span class="p">,</span> <span class="n">management_user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span>
                             <span class="n">management_user</span><span class="o">.</span><span class="n">first_name</span><span class="p">,</span> <span class="n">management_user</span><span class="o">.</span><span class="n">last_name</span><span class="p">,</span> <span class="n">management_user</span><span class="o">.</span><span class="n">organization</span><span class="p">,</span>
                             <span class="n">management_user</span><span class="o">.</span><span class="n">admin</span><span class="p">,</span> <span class="n">management_user</span><span class="o">.</span><span class="n">salt</span><span class="p">))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;management user saved successfully&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">id_of_new_row</span></div>

<div class="viewcode-block" id="MetastoreFacade.update_management_user"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.update_management_user">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">update_management_user</span><span class="p">(</span><span class="n">management_user</span><span class="p">:</span> <span class="n">ManagementUser</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates a management user in the metastore</span>

<span class="sd">        :param management_user: the management user to update</span>
<span class="sd">        :param id: the id of the row to update</span>
<span class="sd">        :return: id of the created record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updating management user with id: </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2"> in the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;UPDATE &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">MANAGEMENT_USERS_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot; SET username=%s, password=%s, email=%s, first_name=%s, last_name=%s, organization=%s, &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;admin=%s, salt=%s WHERE </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">MANAGEMENT_USERS_TABLE</span><span class="si">}</span><span class="s2">.id = %s&quot;</span><span class="p">,</span>
                            <span class="p">(</span><span class="n">management_user</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">management_user</span><span class="o">.</span><span class="n">password</span><span class="p">,</span> <span class="n">management_user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span>
                             <span class="n">management_user</span><span class="o">.</span><span class="n">first_name</span><span class="p">,</span> <span class="n">management_user</span><span class="o">.</span><span class="n">last_name</span><span class="p">,</span> <span class="n">management_user</span><span class="o">.</span><span class="n">organization</span><span class="p">,</span>
                             <span class="n">management_user</span><span class="o">.</span><span class="n">admin</span><span class="p">,</span> <span class="n">management_user</span><span class="o">.</span><span class="n">salt</span><span class="p">,</span> <span class="nb">id</span><span class="p">))</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Management user with id: </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2"> updated successfully&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetastoreFacade.remove_management_user"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.remove_management_user">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">remove_management_user</span><span class="p">(</span><span class="n">management_user</span><span class="p">:</span> <span class="n">ManagementUser</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes a management user from the metastore</span>

<span class="sd">        :param management_user: the user to remove</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing management user with &quot;</span>
                                             <span class="sa">f</span><span class="s2">&quot;id:</span><span class="si">{</span><span class="n">management_user</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> from the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DELETE FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">MANAGEMENT_USERS_TABLE</span><span class="si">}</span><span class="s2"> WHERE id = %s&quot;</span><span class="p">,</span>
                            <span class="p">(</span><span class="n">management_user</span><span class="o">.</span><span class="n">id</span><span class="p">,))</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Management user with &quot;</span>
                                                     <span class="sa">f</span><span class="s2">&quot;id </span><span class="si">{</span><span class="n">management_user</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> deleted successfully&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetastoreFacade.get_management_user_by_username"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.get_management_user_by_username">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_management_user_by_username</span><span class="p">(</span><span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">ManagementUser</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for extracting a management user account based on the username</span>

<span class="sd">        :param username: the username of the user</span>
<span class="sd">        :return: The management user or None if no user with the given username was found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">MANAGEMENT_USERS_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;WHERE username = %s&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">username</span><span class="p">,))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">record</span> <span class="o">=</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_management_user_record_to_dto</span><span class="p">(</span><span class="n">management_user_record</span><span class="o">=</span><span class="n">record</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">record</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_convert_session_token_record_to_dto</span><span class="p">(</span><span class="n">session_token_record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SessionToken</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts a session token record fetched from the metastore into a DTO</span>

<span class="sd">        :param session_token_record: the record to convert</span>
<span class="sd">        :return: the DTO representing the record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">session_token</span> <span class="o">=</span> <span class="n">SessionToken</span><span class="p">(</span><span class="n">token</span><span class="o">=</span><span class="n">session_token_record</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">timestamp</span><span class="o">=</span><span class="n">session_token_record</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                     <span class="n">username</span><span class="o">=</span><span class="n">session_token_record</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">session_token</span>

<div class="viewcode-block" id="MetastoreFacade.list_session_tokens"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_session_tokens">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_session_tokens</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">SessionToken</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of session tokens in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">SESSION_TOKENS_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_session_token_record_to_dto</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">records</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetastoreFacade.get_session_token_metadata"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.get_session_token_metadata">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_session_token_metadata</span><span class="p">(</span><span class="n">token</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">SessionToken</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for fetching the metadata of a given session token</span>

<span class="sd">        :param token: the token to lookup the metadata dor</span>
<span class="sd">        :return: The session token and its metadata or None if it could not be found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">SESSION_TOKENS_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;WHERE token = %s&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">token</span><span class="p">,))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">record</span> <span class="o">=</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_session_token_record_to_dto</span><span class="p">(</span>
                        <span class="n">session_token_record</span><span class="o">=</span><span class="n">record</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">record</span></div>

<div class="viewcode-block" id="MetastoreFacade.save_session_token"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.save_session_token">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">save_session_token</span><span class="p">(</span><span class="n">session_token</span><span class="p">:</span> <span class="n">SessionToken</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves a session token to the metastore</span>

<span class="sd">        :param session_token: the session token to save</span>
<span class="sd">        :return: token of the created record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Saving a session token in the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INSERT INTO </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">SESSION_TOKENS_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;(token, timestamp, username) &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;VALUES (%s, %s, %s) RETURNING token&quot;</span><span class="p">,</span>
                                <span class="p">(</span><span class="n">session_token</span><span class="o">.</span><span class="n">token</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="n">session_token</span><span class="o">.</span><span class="n">username</span><span class="p">))</span>
                    <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                    <span class="n">token_of_new_row</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">token_of_new_row</span> <span class="o">=</span> <span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                    <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Session token saved successfully&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">token_of_new_row</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not save session token to database, error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">, &quot;</span>
                                                         <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="MetastoreFacade.update_session_token"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.update_session_token">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">update_session_token</span><span class="p">(</span><span class="n">session_token</span><span class="p">:</span> <span class="n">SessionToken</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates a session token in the metastore</span>

<span class="sd">        :param session_token: the session token to update</span>
<span class="sd">        :param token: the token of the row to update</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updating session token with token: </span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="s2"> in the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;UPDATE &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">SESSION_TOKENS_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot; SET token=%s, timestamp=%s, username=%s &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;WHERE </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">SESSION_TOKENS_TABLE</span><span class="si">}</span><span class="s2">.token = %s&quot;</span><span class="p">,</span>
                            <span class="p">(</span><span class="n">session_token</span><span class="o">.</span><span class="n">token</span><span class="p">,</span> <span class="n">session_token</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span> <span class="n">session_token</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
                             <span class="n">token</span><span class="p">))</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Session token </span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="s2"> updated successfully&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetastoreFacade.remove_session_token"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.remove_session_token">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">remove_session_token</span><span class="p">(</span><span class="n">session_token</span><span class="p">:</span> <span class="n">SessionToken</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes a session token from the metastore</span>

<span class="sd">        :param session_token: the session token to remove</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing session token with &quot;</span>
                                             <span class="sa">f</span><span class="s2">&quot;token:</span><span class="si">{</span><span class="n">session_token</span><span class="o">.</span><span class="n">token</span><span class="si">}</span><span class="s2"> from the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DELETE FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">SESSION_TOKENS_TABLE</span><span class="si">}</span><span class="s2"> WHERE token = %s&quot;</span><span class="p">,</span>
                            <span class="p">(</span><span class="n">session_token</span><span class="o">.</span><span class="n">token</span><span class="p">,))</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Session token with &quot;</span>
                                                     <span class="sa">f</span><span class="s2">&quot;token </span><span class="si">{</span><span class="n">session_token</span><span class="o">.</span><span class="n">token</span><span class="si">}</span><span class="s2"> deleted successfully&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetastoreFacade.get_session_token_by_username"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.get_session_token_by_username">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_session_token_by_username</span><span class="p">(</span><span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">SessionToken</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for extracting a session token account based on the username</span>

<span class="sd">        :param username: the username of the user</span>
<span class="sd">        :return: The session token or None if no user with the given username was found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">SESSION_TOKENS_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;WHERE username = %s&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">username</span><span class="p">,))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">record</span> <span class="o">=</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_session_token_record_to_dto</span><span class="p">(</span><span class="n">session_token_record</span><span class="o">=</span><span class="n">record</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">record</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_convert_traces_dataset_record_to_dto</span><span class="p">(</span><span class="n">traces_dataset_record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TracesDataset</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts a traces dataset record fetched from the metastore into a DTO</span>

<span class="sd">        :param traces_dataset_record: the record to convert</span>
<span class="sd">        :return: the DTO representing the record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data_schema</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">traces_dataset_record</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">traces_dataset_record</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">data_schema_json_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">traces_dataset_record</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
            <span class="n">data_schema</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data_schema_json_str</span><span class="p">)</span>
        <span class="n">traces_dataset</span> <span class="o">=</span> <span class="n">TracesDataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">traces_dataset_record</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">description</span><span class="o">=</span><span class="n">traces_dataset_record</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                                       <span class="n">data_schema</span><span class="o">=</span><span class="n">data_schema</span><span class="p">,</span> <span class="n">download_count</span><span class="o">=</span><span class="n">traces_dataset_record</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
                                       <span class="n">file_path</span><span class="o">=</span><span class="n">traces_dataset_record</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">url</span><span class="o">=</span><span class="n">traces_dataset_record</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>
                                       <span class="n">date_added</span><span class="o">=</span><span class="n">traces_dataset_record</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">num_traces</span><span class="o">=</span><span class="n">traces_dataset_record</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span>
                                       <span class="n">num_attributes_per_time_step</span><span class="o">=</span><span class="n">traces_dataset_record</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span>
                                       <span class="n">size_in_gb</span><span class="o">=</span><span class="n">traces_dataset_record</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span>
                                       <span class="n">compressed_size_in_gb</span><span class="o">=</span><span class="n">traces_dataset_record</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span>
                                       <span class="n">citation</span><span class="o">=</span><span class="n">traces_dataset_record</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span> <span class="n">num_files</span><span class="o">=</span><span class="n">traces_dataset_record</span><span class="p">[</span><span class="mi">13</span><span class="p">],</span>
                                       <span class="n">file_format</span><span class="o">=</span><span class="n">traces_dataset_record</span><span class="p">[</span><span class="mi">14</span><span class="p">],</span> <span class="n">added_by</span><span class="o">=</span><span class="n">traces_dataset_record</span><span class="p">[</span><span class="mi">15</span><span class="p">],</span>
                                       <span class="n">columns</span><span class="o">=</span><span class="n">traces_dataset_record</span><span class="p">[</span><span class="mi">16</span><span class="p">])</span>
        <span class="n">traces_dataset</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">traces_dataset_record</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">traces_dataset</span>

<div class="viewcode-block" id="MetastoreFacade.list_traces_datasets_ids"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_traces_datasets_ids">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_traces_datasets_ids</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of traces datasets ids in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT id,name FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">TRACES_DATASETS_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span> <span class="n">records</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetastoreFacade.list_traces_datasets"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_traces_datasets">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_traces_datasets</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">TracesDataset</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of traces datasets in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">TRACES_DATASETS_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_traces_dataset_record_to_dto</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">records</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetastoreFacade.get_traces_dataset_metadata"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.get_traces_dataset_metadata">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_traces_dataset_metadata</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">TracesDataset</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for fetching the metadata of a given dataset name</span>

<span class="sd">        :param id: the id of the dataset to get the metadata of</span>
<span class="sd">        :return: The traces dataset and its metadata or None if it could not be found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">TRACES_DATASETS_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;WHERE id = %s&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">record</span> <span class="o">=</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_traces_dataset_record_to_dto</span><span class="p">(</span>
                        <span class="n">traces_dataset_record</span><span class="o">=</span><span class="n">record</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">record</span></div>

<div class="viewcode-block" id="MetastoreFacade.get_traces_dataset_metadata_by_name"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.get_traces_dataset_metadata_by_name">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_traces_dataset_metadata_by_name</span><span class="p">(</span><span class="n">dataset_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">TracesDataset</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for fetching the metadata of a given dataset name</span>

<span class="sd">        :param dataset_name: the dataset name to lookup the metadata for</span>
<span class="sd">        :return: The traces dataset and its metadata or None if it could not be found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">TRACES_DATASETS_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;WHERE name = %s&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">dataset_name</span><span class="p">,))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">record</span> <span class="o">=</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_traces_dataset_record_to_dto</span><span class="p">(</span>
                        <span class="n">traces_dataset_record</span><span class="o">=</span><span class="n">record</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">record</span></div>

<div class="viewcode-block" id="MetastoreFacade.save_traces_dataset"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.save_traces_dataset">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">save_traces_dataset</span><span class="p">(</span><span class="n">traces_dataset</span><span class="p">:</span> <span class="n">TracesDataset</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves a traces dataset to the metastore</span>

<span class="sd">        :param traces_dataset: the traces dataset to save</span>
<span class="sd">        :return: idg of the created record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Saving a traces dataset in the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">schema_json_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">if</span> <span class="n">traces_dataset</span><span class="o">.</span><span class="n">data_schema</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">schema_json_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">traces_dataset</span><span class="o">.</span><span class="n">data_schema</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
                <span class="c1"># Need to manually set the ID since CITUS does not handle serial columns</span>
                <span class="c1"># on distributed tables properly</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">GeneralUtil</span><span class="o">.</span><span class="n">get_latest_table_id</span><span class="p">(</span>
                    <span class="n">cur</span><span class="o">=</span><span class="n">cur</span><span class="p">,</span> <span class="n">table_name</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">TRACES_DATASETS_TABLE</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INSERT INTO </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">TRACES_DATASETS_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;(id, name, description, data_schema, download_count, &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;file_path, url, date_added, num_traces, &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;num_attributes_per_time_step, size_in_gb, compressed_size_in_gb, citation, num_files, &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;file_format, added_by, columns) &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s) RETURNING id&quot;</span><span class="p">,</span>
                            <span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">traces_dataset</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">traces_dataset</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">schema_json_str</span><span class="p">,</span>
                             <span class="n">traces_dataset</span><span class="o">.</span><span class="n">download_count</span><span class="p">,</span> <span class="n">traces_dataset</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="n">traces_dataset</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
                             <span class="n">traces_dataset</span><span class="o">.</span><span class="n">date_added</span><span class="p">,</span> <span class="n">traces_dataset</span><span class="o">.</span><span class="n">num_traces</span><span class="p">,</span>
                             <span class="n">traces_dataset</span><span class="o">.</span><span class="n">num_attributes_per_time_step</span><span class="p">,</span>
                             <span class="n">traces_dataset</span><span class="o">.</span><span class="n">size_in_gb</span><span class="p">,</span> <span class="n">traces_dataset</span><span class="o">.</span><span class="n">compressed_size_in_gb</span><span class="p">,</span>
                             <span class="n">traces_dataset</span><span class="o">.</span><span class="n">citation</span><span class="p">,</span> <span class="n">traces_dataset</span><span class="o">.</span><span class="n">num_files</span><span class="p">,</span> <span class="n">traces_dataset</span><span class="o">.</span><span class="n">file_format</span><span class="p">,</span>
                             <span class="n">traces_dataset</span><span class="o">.</span><span class="n">added_by</span><span class="p">,</span> <span class="n">traces_dataset</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;traces dataset saved successfully&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">id_of_new_row</span></div>

<div class="viewcode-block" id="MetastoreFacade.update_traces_dataset"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.update_traces_dataset">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">update_traces_dataset</span><span class="p">(</span><span class="n">traces_dataset</span><span class="p">:</span> <span class="n">TracesDataset</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates a traces dataset in the metastore</span>

<span class="sd">        :param traces_dataset: the traces dataset to update</span>
<span class="sd">        :param id: the id of the row to update</span>
<span class="sd">        :return: id of the created record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updating traces dataset with id: </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2"> in the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">schema_json_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">if</span> <span class="n">traces_dataset</span><span class="o">.</span><span class="n">data_schema</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">schema_json_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">traces_dataset</span><span class="o">.</span><span class="n">data_schema</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;UPDATE &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">TRACES_DATASETS_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot; SET name=%s, description=%s, data_schema=%s, download_count=%s, file_path=%s, &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;url=%s, date_added=%s, num_traces=%s, num_attributes_per_time_step=%s, size_in_gb=%s, &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;compressed_size_in_gb=%s, citation=%s, num_files=%s, file_format=%s, added_by=%s, &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;columns=%s &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;WHERE </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">TRACES_DATASETS_TABLE</span><span class="si">}</span><span class="s2">.id = %s&quot;</span><span class="p">,</span>
                            <span class="p">(</span><span class="n">traces_dataset</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">traces_dataset</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">schema_json_str</span><span class="p">,</span>
                             <span class="n">traces_dataset</span><span class="o">.</span><span class="n">download_count</span><span class="p">,</span> <span class="n">traces_dataset</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="n">traces_dataset</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
                             <span class="n">traces_dataset</span><span class="o">.</span><span class="n">date_added</span><span class="p">,</span> <span class="n">traces_dataset</span><span class="o">.</span><span class="n">num_traces</span><span class="p">,</span>
                             <span class="n">traces_dataset</span><span class="o">.</span><span class="n">num_attributes_per_time_step</span><span class="p">,</span> <span class="n">traces_dataset</span><span class="o">.</span><span class="n">size_in_gb</span><span class="p">,</span>
                             <span class="n">traces_dataset</span><span class="o">.</span><span class="n">compressed_size_in_gb</span><span class="p">,</span> <span class="n">traces_dataset</span><span class="o">.</span><span class="n">citation</span><span class="p">,</span>
                             <span class="n">traces_dataset</span><span class="o">.</span><span class="n">num_files</span><span class="p">,</span> <span class="n">traces_dataset</span><span class="o">.</span><span class="n">file_format</span><span class="p">,</span> <span class="n">traces_dataset</span><span class="o">.</span><span class="n">added_by</span><span class="p">,</span>
                             <span class="n">traces_dataset</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="nb">id</span><span class="p">))</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Traces dataset with </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2"> updated successfully&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetastoreFacade.remove_traces_dataset"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.remove_traces_dataset">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">remove_traces_dataset</span><span class="p">(</span><span class="n">traces_dataset</span><span class="p">:</span> <span class="n">TracesDataset</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes a traces dataset from the metastore</span>

<span class="sd">        :param traces_dataset: the traces dataset to remove</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing traces dataset with &quot;</span>
                                             <span class="sa">f</span><span class="s2">&quot;id:</span><span class="si">{</span><span class="n">traces_dataset</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> from the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DELETE FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">TRACES_DATASETS_TABLE</span><span class="si">}</span><span class="s2"> WHERE id = %s&quot;</span><span class="p">,</span>
                            <span class="p">(</span><span class="n">traces_dataset</span><span class="o">.</span><span class="n">id</span><span class="p">,))</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Traces dataset with &quot;</span>
                                                     <span class="sa">f</span><span class="s2">&quot;id </span><span class="si">{</span><span class="n">traces_dataset</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> deleted successfully&quot;</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_convert_statistics_dataset_record_to_dto</span><span class="p">(</span><span class="n">statistics_dataset_record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StatisticsDataset</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts a statistics dataset record fetched from the metastore into a DTO</span>

<span class="sd">        :param statistics_dataset_record: the record to convert</span>
<span class="sd">        :return: the DTO representing the record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">statistics_dataset</span> <span class="o">=</span> <span class="n">StatisticsDataset</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">statistics_dataset_record</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">description</span><span class="o">=</span><span class="n">statistics_dataset_record</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="n">download_count</span><span class="o">=</span><span class="n">statistics_dataset_record</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
            <span class="n">file_path</span><span class="o">=</span><span class="n">statistics_dataset_record</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">url</span><span class="o">=</span><span class="n">statistics_dataset_record</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
            <span class="n">date_added</span><span class="o">=</span><span class="n">statistics_dataset_record</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">num_measurements</span><span class="o">=</span><span class="n">statistics_dataset_record</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span>
            <span class="n">num_metrics</span><span class="o">=</span><span class="n">statistics_dataset_record</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">size_in_gb</span><span class="o">=</span><span class="n">statistics_dataset_record</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span>
            <span class="n">compressed_size_in_gb</span><span class="o">=</span><span class="n">statistics_dataset_record</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span>
            <span class="n">citation</span><span class="o">=</span><span class="n">statistics_dataset_record</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span> <span class="n">num_files</span><span class="o">=</span><span class="n">statistics_dataset_record</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span>
            <span class="n">file_format</span><span class="o">=</span><span class="n">statistics_dataset_record</span><span class="p">[</span><span class="mi">13</span><span class="p">],</span> <span class="n">added_by</span><span class="o">=</span><span class="n">statistics_dataset_record</span><span class="p">[</span><span class="mi">14</span><span class="p">],</span>
            <span class="n">conditions</span><span class="o">=</span><span class="n">statistics_dataset_record</span><span class="p">[</span><span class="mi">15</span><span class="p">],</span> <span class="n">metrics</span><span class="o">=</span><span class="n">statistics_dataset_record</span><span class="p">[</span><span class="mi">16</span><span class="p">],</span>
            <span class="n">num_conditions</span><span class="o">=</span><span class="n">statistics_dataset_record</span><span class="p">[</span><span class="mi">17</span><span class="p">])</span>
        <span class="n">statistics_dataset</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">statistics_dataset_record</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">statistics_dataset</span>

<div class="viewcode-block" id="MetastoreFacade.list_statistics_datasets_ids"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_statistics_datasets_ids">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_statistics_datasets_ids</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of statistics datasets ids in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT id,name FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">STATISTICS_DATASETS_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span> <span class="n">records</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetastoreFacade.list_statistics_datasets"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_statistics_datasets">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_statistics_datasets</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">StatisticsDataset</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of statistics datasets in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">STATISTICS_DATASETS_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_statistics_dataset_record_to_dto</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">records</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetastoreFacade.get_statistics_dataset_metadata"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.get_statistics_dataset_metadata">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_statistics_dataset_metadata</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">StatisticsDataset</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for fetching the metadata of a given dataset name</span>

<span class="sd">        :param id: the id of the dataset to get the metadata of</span>
<span class="sd">        :return: The statistics dataset and its metadata or None if it could not be found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">STATISTICS_DATASETS_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;WHERE id = %s&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">record</span> <span class="o">=</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_statistics_dataset_record_to_dto</span><span class="p">(</span>
                        <span class="n">statistics_dataset_record</span><span class="o">=</span><span class="n">record</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">record</span></div>

<div class="viewcode-block" id="MetastoreFacade.get_statistics_dataset_metadata_by_name"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.get_statistics_dataset_metadata_by_name">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_statistics_dataset_metadata_by_name</span><span class="p">(</span><span class="n">dataset_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">StatisticsDataset</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for fetching the metadata of a given dataset name</span>

<span class="sd">        :param dataset_name: the dataset name to lookup the metadata for</span>
<span class="sd">        :return: The statistics dataset and its metadata or None if it could not be found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">STATISTICS_DATASETS_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;WHERE name = %s&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">dataset_name</span><span class="p">,))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">record</span> <span class="o">=</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_statistics_dataset_record_to_dto</span><span class="p">(</span>
                        <span class="n">statistics_dataset_record</span><span class="o">=</span><span class="n">record</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">record</span></div>

<div class="viewcode-block" id="MetastoreFacade.save_statistics_dataset"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.save_statistics_dataset">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">save_statistics_dataset</span><span class="p">(</span><span class="n">statistics_dataset</span><span class="p">:</span> <span class="n">StatisticsDataset</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves a statistics dataset to the metastore</span>

<span class="sd">        :param statistics_dataset: the statistics dataset to save</span>
<span class="sd">        :return: idg of the created record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Saving a statistics dataset in the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="c1"># Need to manually set the ID since CITUS does not handle serial columns</span>
                <span class="c1"># on distributed tables properly</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">GeneralUtil</span><span class="o">.</span><span class="n">get_latest_table_id</span><span class="p">(</span>
                    <span class="n">cur</span><span class="o">=</span><span class="n">cur</span><span class="p">,</span> <span class="n">table_name</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">STATISTICS_DATASETS_TABLE</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INSERT INTO </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">STATISTICS_DATASETS_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;(id, name, description, download_count, file_path, url, date_added, num_measurements, &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;num_metrics, size_in_gb, compressed_size_in_gb, citation, num_files, &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;file_format, added_by, conditions, metrics, num_conditions) &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s) &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;RETURNING id&quot;</span><span class="p">,</span>
                            <span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">statistics_dataset</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">statistics_dataset</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
                             <span class="n">statistics_dataset</span><span class="o">.</span><span class="n">download_count</span><span class="p">,</span> <span class="n">statistics_dataset</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="n">statistics_dataset</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
                             <span class="n">statistics_dataset</span><span class="o">.</span><span class="n">date_added</span><span class="p">,</span> <span class="n">statistics_dataset</span><span class="o">.</span><span class="n">num_measurements</span><span class="p">,</span>
                             <span class="n">statistics_dataset</span><span class="o">.</span><span class="n">num_metrics</span><span class="p">,</span>
                             <span class="n">statistics_dataset</span><span class="o">.</span><span class="n">size_in_gb</span><span class="p">,</span> <span class="n">statistics_dataset</span><span class="o">.</span><span class="n">compressed_size_in_gb</span><span class="p">,</span>
                             <span class="n">statistics_dataset</span><span class="o">.</span><span class="n">citation</span><span class="p">,</span> <span class="n">statistics_dataset</span><span class="o">.</span><span class="n">num_files</span><span class="p">,</span> <span class="n">statistics_dataset</span><span class="o">.</span><span class="n">file_format</span><span class="p">,</span>
                             <span class="n">statistics_dataset</span><span class="o">.</span><span class="n">added_by</span><span class="p">,</span> <span class="n">statistics_dataset</span><span class="o">.</span><span class="n">conditions</span><span class="p">,</span> <span class="n">statistics_dataset</span><span class="o">.</span><span class="n">metrics</span><span class="p">,</span>
                             <span class="n">statistics_dataset</span><span class="o">.</span><span class="n">num_conditions</span><span class="p">))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;statistics dataset saved successfully&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">id_of_new_row</span></div>

<div class="viewcode-block" id="MetastoreFacade.update_statistics_dataset"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.update_statistics_dataset">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">update_statistics_dataset</span><span class="p">(</span><span class="n">statistics_dataset</span><span class="p">:</span> <span class="n">StatisticsDataset</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates a statistics dataset in the metastore</span>

<span class="sd">        :param statistics_dataset: the statistics dataset to update</span>
<span class="sd">        :param id: the id of the row to update</span>
<span class="sd">        :return: id of the created record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updating statistics dataset with id: </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2"> in the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;UPDATE &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">STATISTICS_DATASETS_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot; SET name=%s, description=%s, download_count=%s, file_path=%s, &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;url=%s, date_added=%s, num_measurements=%s, num_metrics=%s, size_in_gb=%s, &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;compressed_size_in_gb=%s, citation=%s, num_files=%s, file_format=%s, added_by=%s, &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;conditions=%s, metrics=%s, num_conditions=%s &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;WHERE </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">STATISTICS_DATASETS_TABLE</span><span class="si">}</span><span class="s2">.id = %s&quot;</span><span class="p">,</span>
                            <span class="p">(</span><span class="n">statistics_dataset</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">statistics_dataset</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
                             <span class="n">statistics_dataset</span><span class="o">.</span><span class="n">download_count</span><span class="p">,</span> <span class="n">statistics_dataset</span><span class="o">.</span><span class="n">file_path</span><span class="p">,</span> <span class="n">statistics_dataset</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
                             <span class="n">statistics_dataset</span><span class="o">.</span><span class="n">date_added</span><span class="p">,</span> <span class="n">statistics_dataset</span><span class="o">.</span><span class="n">num_measurements</span><span class="p">,</span>
                             <span class="n">statistics_dataset</span><span class="o">.</span><span class="n">num_metrics</span><span class="p">,</span> <span class="n">statistics_dataset</span><span class="o">.</span><span class="n">size_in_gb</span><span class="p">,</span>
                             <span class="n">statistics_dataset</span><span class="o">.</span><span class="n">compressed_size_in_gb</span><span class="p">,</span> <span class="n">statistics_dataset</span><span class="o">.</span><span class="n">citation</span><span class="p">,</span>
                             <span class="n">statistics_dataset</span><span class="o">.</span><span class="n">num_files</span><span class="p">,</span> <span class="n">statistics_dataset</span><span class="o">.</span><span class="n">file_format</span><span class="p">,</span> <span class="n">statistics_dataset</span><span class="o">.</span><span class="n">added_by</span><span class="p">,</span>
                             <span class="n">statistics_dataset</span><span class="o">.</span><span class="n">conditions</span><span class="p">,</span> <span class="n">statistics_dataset</span><span class="o">.</span><span class="n">metrics</span><span class="p">,</span>
                             <span class="n">statistics_dataset</span><span class="o">.</span><span class="n">num_conditions</span><span class="p">,</span> <span class="nb">id</span><span class="p">))</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Statistics dataset with </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2"> updated successfully&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetastoreFacade.remove_statistics_dataset"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.remove_statistics_dataset">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">remove_statistics_dataset</span><span class="p">(</span><span class="n">statistics_dataset</span><span class="p">:</span> <span class="n">StatisticsDataset</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes a statistics dataset from the metastore</span>

<span class="sd">        :param statistics_dataset: the statistic dataset to remove</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing statistics dataset with &quot;</span>
                                             <span class="sa">f</span><span class="s2">&quot;id:</span><span class="si">{</span><span class="n">statistics_dataset</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> from the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DELETE FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">STATISTICS_DATASETS_TABLE</span><span class="si">}</span><span class="s2"> WHERE id = %s&quot;</span><span class="p">,</span>
                            <span class="p">(</span><span class="n">statistics_dataset</span><span class="o">.</span><span class="n">id</span><span class="p">,))</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Statistics dataset with &quot;</span>
                                                     <span class="sa">f</span><span class="s2">&quot;id </span><span class="si">{</span><span class="n">statistics_dataset</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> deleted successfully&quot;</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_convert_config_record_to_dto</span><span class="p">(</span><span class="n">config_record</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Config</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts a config record fetched from the metastore into a DTO</span>

<span class="sd">        :param config_record: the record to convert</span>
<span class="sd">        :return: the DTO representing the record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">config_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">config_record</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
        <span class="n">config</span><span class="p">:</span> <span class="n">Config</span> <span class="o">=</span> <span class="n">Config</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">config_json</span><span class="p">))</span>
        <span class="n">config</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">config_record</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">config</span>

<div class="viewcode-block" id="MetastoreFacade.list_configs"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_configs">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_configs</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Config</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of configs in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">CONFIG_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_config_record_to_dto</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">records</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetastoreFacade.list_config_ids"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_config_ids">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_config_ids</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of config ids in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT id FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">CONFIG_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">records</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetastoreFacade.get_config"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.get_config">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_config</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">Config</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for fetching the config with a given id from the metastore</span>

<span class="sd">        :param id: the id of the config</span>
<span class="sd">        :return: The config or None if it could not be found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">CONFIG_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;WHERE id = %s&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">record</span> <span class="o">=</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_config_record_to_dto</span><span class="p">(</span><span class="n">config_record</span><span class="o">=</span><span class="n">record</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">record</span></div>

<div class="viewcode-block" id="MetastoreFacade.save_config"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.save_config">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">save_config</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="n">Config</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves a config to the metastore</span>

<span class="sd">        :param config: the config to save</span>
<span class="sd">        :return: id of the config</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Updating the configuration in the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">config_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INSERT INTO </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">CONFIG_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;(id, config) &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;VALUES (%s, %s) RETURNING id&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">config_json</span><span class="p">,))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;config saved successfully&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">id_of_new_row</span></div>

<div class="viewcode-block" id="MetastoreFacade.update_config"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.update_config">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">update_config</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="n">Config</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates a config in the metastore</span>

<span class="sd">        :param config: the config to save</span>
<span class="sd">        :param id: the id of the row to update</span>
<span class="sd">        :return: id of the created record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updating config with id: </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2"> in the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">config_json_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;UPDATE &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">CONFIG_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot; SET config=%s &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;WHERE </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">CONFIG_TABLE</span><span class="si">}</span><span class="s2">.id = %s&quot;</span><span class="p">,</span>
                            <span class="p">(</span><span class="n">config_json_str</span><span class="p">,</span> <span class="nb">id</span><span class="p">))</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Config with id: </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2"> updated successfully&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetastoreFacade.remove_config"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.remove_config">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">remove_config</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="n">Config</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes a config from the metastore</span>

<span class="sd">        :param config: the config to remove</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing config with &quot;</span>
                                             <span class="sa">f</span><span class="s2">&quot;id:</span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> from the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DELETE FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">CONFIG_TABLE</span><span class="si">}</span><span class="s2"> WHERE id = %s&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">id</span><span class="p">,))</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Config with &quot;</span>
                                                     <span class="sa">f</span><span class="s2">&quot;id </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> deleted successfully&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetastoreFacade.list_linear_threshold_stopping_policies"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_linear_threshold_stopping_policies">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_linear_threshold_stopping_policies</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">LinearThresholdStoppingPolicy</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of Linear-threshold stopping policies in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">LINEAR_THRESHOLD_STOPPING_POLICIES_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_linear_threshold_stopping_policy_record_to_dto</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">records</span><span class="p">))</span></div>

<div class="viewcode-block" id="MetastoreFacade.list_linear_threshold_stopping_policies_ids"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.list_linear_threshold_stopping_policies_ids">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">list_linear_threshold_stopping_policies_ids</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: A list of Linear-threshold stopping policies ids in the metastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT id,simulation_name FROM &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">LINEAR_THRESHOLD_STOPPING_POLICIES_TABLE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">records</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span> <span class="n">records</span><span class="p">))</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_convert_linear_threshold_stopping_policy_record_to_dto</span><span class="p">(</span><span class="n">linear_threshold_stopping_policy_record</span><span class="p">)</span> \
            <span class="o">-&gt;</span> <span class="n">LinearThresholdStoppingPolicy</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts a Linear-threshold stopping policy record fetched from the metastore into a DTO</span>

<span class="sd">        :param linear_threshold_stopping_policy_record: the record to convert</span>
<span class="sd">        :return: the DTO representing the record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">linear_threshold_stopping_policy_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">linear_threshold_stopping_policy_record</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                                                           <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
        <span class="n">linear_threshold_stopping_policy</span><span class="p">:</span> <span class="n">LinearThresholdStoppingPolicy</span> <span class="o">=</span> <span class="n">LinearThresholdStoppingPolicy</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span>
            <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">linear_threshold_stopping_policy_json</span><span class="p">))</span>
        <span class="n">linear_threshold_stopping_policy</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">linear_threshold_stopping_policy_record</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">linear_threshold_stopping_policy</span>

<div class="viewcode-block" id="MetastoreFacade.get_linear_threshold_stopping_policy"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.get_linear_threshold_stopping_policy">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_linear_threshold_stopping_policy</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">LinearThresholdStoppingPolicy</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for fetching a mult-threshold policy with a given id from the metastore</span>

<span class="sd">        :param id: the id of the linear-threshold policy</span>
<span class="sd">        :return: The mult-threshold policy or None if it could not be found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">LINEAR_THRESHOLD_STOPPING_POLICIES_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;WHERE id = %s&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">record</span> <span class="o">=</span> <span class="n">MetastoreFacade</span><span class="o">.</span><span class="n">_convert_linear_threshold_stopping_policy_record_to_dto</span><span class="p">(</span>
                        <span class="n">linear_threshold_stopping_policy_record</span><span class="o">=</span><span class="n">record</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">record</span></div>

<div class="viewcode-block" id="MetastoreFacade.remove_linear_threshold_stopping_policy"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.remove_linear_threshold_stopping_policy">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">remove_linear_threshold_stopping_policy</span><span class="p">(</span>
            <span class="n">linear_threshold_stopping_policy</span><span class="p">:</span> <span class="n">LinearThresholdStoppingPolicy</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes a linear-threshold stopping policy from the metastore</span>

<span class="sd">        :param linear_threshold_stopping_policy: the policy to remove</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing Linear-threshold stopping policy with &quot;</span>
                                             <span class="sa">f</span><span class="s2">&quot;id:</span><span class="si">{</span><span class="n">linear_threshold_stopping_policy</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> from the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DELETE FROM </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">LINEAR_THRESHOLD_STOPPING_POLICIES_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;WHERE id = %s&quot;</span><span class="p">,</span>
                            <span class="p">(</span><span class="n">linear_threshold_stopping_policy</span><span class="o">.</span><span class="n">id</span><span class="p">,))</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Linear-threshold stopping policy &quot;</span>
                                                     <span class="sa">f</span><span class="s2">&quot;with id </span><span class="si">{</span><span class="n">linear_threshold_stopping_policy</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> &quot;</span>
                                                     <span class="sa">f</span><span class="s2">&quot;deleted successfully&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetastoreFacade.save_linear_threshold_stopping_policy"><a class="viewcode-back" href="../../../csle_common.metastore.html#csle_common.metastore.metastore_facade.MetastoreFacade.save_linear_threshold_stopping_policy">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">save_linear_threshold_stopping_policy</span><span class="p">(</span><span class="n">linear_threshold_stopping_policy</span><span class="p">:</span> <span class="n">LinearThresholdStoppingPolicy</span><span class="p">)</span> \
            <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves a linear-threshold stopping policy to the metastore</span>

<span class="sd">        :param linear_threshold_stopping_policy: the policy to save</span>
<span class="sd">        :return: id of the created record</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Installing a linear-threshold stopping policy in the metastore&quot;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">psycopg</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DB_NAME_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">DBNAME</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">USER</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PW_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">PASSWORD</span><span class="si">}</span><span class="s2"> &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST_PROPERTY</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">HOST</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
                <span class="c1"># Need to manually set the ID since CITUS does not handle serial columns</span>
                <span class="c1"># on distributed tables properly</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">GeneralUtil</span><span class="o">.</span><span class="n">get_latest_table_id</span><span class="p">(</span>
                    <span class="n">cur</span><span class="o">=</span><span class="n">cur</span><span class="p">,</span> <span class="n">table_name</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">LINEAR_THRESHOLD_STOPPING_POLICIES_TABLE</span><span class="p">)</span>
                <span class="n">policy_json_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">linear_threshold_stopping_policy</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                             <span class="bp">cls</span><span class="o">=</span><span class="n">NpEncoder</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INSERT INTO </span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">METADATA_STORE</span><span class="o">.</span><span class="n">LINEAR_THRESHOLD_STOPPING_POLICIES_TABLE</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;(id, policy, simulation_name) &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;VALUES (%s, %s, %s) RETURNING id&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">policy_json_str</span><span class="p">,</span>
                                                                  <span class="n">linear_threshold_stopping_policy</span><span class="o">.</span><span class="n">simulation_name</span><span class="p">))</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">id_of_new_row</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">Logger</span><span class="o">.</span><span class="fm">__call__</span><span class="p">()</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Linear-threshold policy saved successfully&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">id_of_new_row</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2025, Kim Hammar.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>